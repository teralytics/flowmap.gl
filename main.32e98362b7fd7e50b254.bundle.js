(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{191:function(module,exports){},26:function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,"isFeatureCollection",(function(){return isFeatureCollection})),__webpack_require__.d(__webpack_exports__,"PickingType",(function(){return PickingType})),__webpack_require__.d(__webpack_exports__,"getColorsRGBA",(function(){return getColorsRGBA})),__webpack_require__.d(__webpack_exports__,"getDiffColorsRGBA",(function(){return getDiffColorsRGBA})),__webpack_require__.d(__webpack_exports__,"isDiffColorsRGBA",(function(){return isDiffColorsRGBA})),__webpack_require__.d(__webpack_exports__,"rgbaAsString",(function(){return rgbaAsString}));var composite_layer=__webpack_require__(847),geojson_layer=__webpack_require__(848),lib_layer=__webpack_require__(431),project32=__webpack_require__(412),picking=__webpack_require__(420),esm=__webpack_require__(67),model=__webpack_require__(432),geometry=__webpack_require__(841);class AnimatedFlowLinesLayer_AnimatedFlowLinesLayer extends lib_layer.a{constructor(props){super(props)}getShaders(){return super.getShaders({vs:"#define SHADER_NAME animated-flow-lines-layer-vertex-shader\n#define SPEED 0.015\n#define NUM_PARTS 5.0\n\nattribute vec3 positions;\nattribute vec3 instanceSourcePositions;\nattribute vec3 instanceTargetPositions;\nattribute vec3 instanceSourcePositions64Low;\nattribute vec3 instanceTargetPositions64Low;\nattribute vec4 instanceColors;\nattribute vec3 instancePickingColors;\nattribute float instanceWidths;\nattribute float instancePickable;\nattribute float instanceStaggering;\n\nuniform float opacity;\nuniform float currentTime;\nuniform float thicknessUnit;\n    \nvarying vec4 vColor;\nvarying float sourceToTarget;\nvarying vec2 uv;\n\n// offset vector by strokeWidth pixels\n// offset_direction is -1 (left) or 1 (right)\nvec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction, float width) {\n  // normalized direction of the line\n  vec2 dir_screenspace = normalize(line_clipspace * project_uViewportSize);\n  // rotate by 90 degrees\n  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);\n\n  return dir_screenspace * offset_direction * width / 2.0;\n}\n\nvoid main(void) {\n  geometry.worldPosition = instanceSourcePositions;\n  geometry.worldPositionAlt = instanceTargetPositions;\n\n  // Position\n  vec4 source_commonspace;\n  vec4 target_commonspace;\n  vec4 source = project_position_to_clipspace(instanceSourcePositions, instanceSourcePositions64Low, vec3(0.), source_commonspace);\n  vec4 target = project_position_to_clipspace(instanceTargetPositions, instanceTargetPositions64Low, vec3(0.), target_commonspace);\n\n  float widthPixels = instanceWidths * thicknessUnit;\n  \n  \n  // linear interpolation of source & target to pick right coord\n  float segmentIndex = positions.x;\n  vec4 p = mix(source, target, segmentIndex);\n  geometry.position = mix(source_commonspace, target_commonspace, segmentIndex);\n  uv = positions.xy;\n  geometry.uv = uv;\n  if (instancePickable > 0.5) {\n    geometry.pickingColor = instancePickingColors;\n  }\n  \n  // extrude\n  vec3 offset = vec3(\n    getExtrusionOffset(target.xy - source.xy, positions.y, widthPixels),\n    0.0);\n  DECKGL_FILTER_SIZE(offset, geometry);\n  gl_Position = p + vec4(project_pixel_size_to_clipspace(offset.xy), 0.0, 0.0);\n  DECKGL_FILTER_GL_POSITION(gl_Position, geometry);\n\n  // Color\n  vColor = vec4(instanceColors.rgb, instanceColors.a * opacity) / 255.;\n  DECKGL_FILTER_COLOR(vColor, geometry);\n\n  sourceToTarget = positions.x * length(source - target) * NUM_PARTS - currentTime * SPEED + instanceStaggering; \n}\n",fs:"#define SHADER_NAME animated-flow-lines-layer-fragment-shader\n\nprecision highp float;\n\nuniform float animationTailLength;\n\nvarying vec4 vColor;\nvarying float sourceToTarget;\nvarying vec2 uv;\n                                   \nvoid main(void) {\n  geometry.uv = uv;\n\n  gl_FragColor = vec4(vColor.xyz, vColor.w * smoothstep(1.0 - animationTailLength, 1.0, fract(sourceToTarget)));\n\n  DECKGL_FILTER_COLOR(gl_FragColor, geometry);\n}\n",modules:[project32.a,picking.a],shaderCache:this.context.shaderCache})}initializeState(){this.getAttributeManager().addInstanced({instanceSourcePositions:{size:3,transition:!0,accessor:"getSourcePosition"},instanceTargetPositions:{size:3,transition:!0,accessor:"getTargetPosition"},instanceColors:{size:4,type:esm.a.UNSIGNED_BYTE,transition:!0,accessor:"getColor",defaultValue:[0,0,0,255]},instanceWidths:{size:1,transition:!0,accessor:"getThickness",defaultValue:1},instanceStaggering:{accessor:"getStaggering",size:1,transition:!1},instancePickable:{accessor:"getPickable",size:1,transition:!1}})}updateState({props:props,oldProps:oldProps,changeFlags:changeFlags}){if(super.updateState({props:props,oldProps:oldProps,changeFlags:changeFlags}),changeFlags.extensionsChanged){const{gl:gl}=this.context;this.state.model&&this.state.model.delete(),this.setState({model:this._getModel(gl)}),this.getAttributeManager().invalidateAll()}}draw({uniforms:uniforms}){const{currentTime:currentTime,thicknessUnit:thicknessUnit,animationTailLength:animationTailLength}=this.props;this.state.model.setUniforms(Object.assign(Object.assign({},uniforms),{thicknessUnit:4*thicknessUnit,animationTailLength:animationTailLength,currentTime:currentTime})).draw()}_getModel(gl){return new model.a(gl,Object.assign({},this.getShaders(),{id:this.props.id,geometry:new geometry.a({drawMode:esm.a.TRIANGLE_STRIP,attributes:{positions:new Float32Array([0,-1,0,0,1,0,1,-1,0,1,1,0])}}),isInstanced:!0}))}}AnimatedFlowLinesLayer_AnimatedFlowLinesLayer.defaultProps={currentTime:0,animationTailLength:.7,getSourcePosition:{type:"accessor",value:d=>d.sourcePosition},getTargetPosition:{type:"accessor",value:d=>d.targetPosition},getPickable:{type:"accessor",value:d=>1},getStaggering:{type:"accessor",value:(d,{index:index})=>Math.random()},getColor:{type:"accessor",value:[0,132,193,255]},getThickness:{type:"accessor",value:1},thicknessUnit:30,parameters:{depthTest:!1}};const FlowCirclesLayer_DEFAULT_COLOR=[0,0,0,255];class FlowCirclesLayer_FlowCirclesLayer extends lib_layer.a{constructor(props){super(props)}getShaders(){return super.getShaders({vs:"#define SHADER_NAME flow-circles-layer-vertex-shader\n#define radiusScale 100\n\nattribute vec3 positions;\n\nattribute vec3 instancePositions;\nattribute vec3 instancePositions64Low;\nattribute float instanceRadius;\nattribute vec4 instanceColors;\nattribute vec3 instancePickingColors;\n\nuniform float opacity;\nvarying vec4 vColor;\nvarying vec2 unitPosition;\nvarying float outerRadiusPixels;\n\nvoid main(void) {\n  geometry.worldPosition = instancePositions;\n\n  outerRadiusPixels = instanceRadius;  \n\n  // position on the containing square in [-1, 1] space\n  unitPosition = positions.xy;\n  geometry.uv = unitPosition;\n  geometry.pickingColor = instancePickingColors;\n                                                                                                    \n  // Find the center of the point and add the current vertex\n  vec3 offset = positions * project_pixel_size(outerRadiusPixels);\n  DECKGL_FILTER_SIZE(offset, geometry);\n  gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, offset, geometry.position);\n  DECKGL_FILTER_GL_POSITION(gl_Position, geometry);\n                            \n  // Apply opacity to instance color, or return instance picking color\n  vColor = vec4(instanceColors.rgb / 255., instanceColors.a / 255. * opacity);\n  DECKGL_FILTER_COLOR(vColor, geometry);\n}\n",fs:"#define SHADER_NAME flow-circles-layer-fragment-shader\n#define SOFT_OUTLINE 0.1\nprecision highp float;\n\nvarying vec4 vColor;\nvarying vec2 unitPosition;\nvarying float outerRadiusPixels;\n\nvoid main(void) {\n  geometry.uv = unitPosition;\n  float distToCenter = length(unitPosition);\n  if (distToCenter > 1.0) {\n    discard;\n  }\n  gl_FragColor = vColor;\n  gl_FragColor.a *= smoothstep(0.0, SOFT_OUTLINE, 1.0 - distToCenter);\n  DECKGL_FILTER_COLOR(gl_FragColor, geometry);\n}\n",modules:[project32.a,picking.a]})}initializeState(){this.getAttributeManager().addInstanced({instancePositions:{size:3,type:esm.a.DOUBLE,fp64:this.use64bitPositions(),transition:!0,accessor:"getPosition"},instanceRadius:{size:1,transition:!0,accessor:"getRadius",defaultValue:1},instanceColors:{size:4,transition:!0,type:esm.a.UNSIGNED_BYTE,accessor:"getColor",defaultValue:FlowCirclesLayer_DEFAULT_COLOR}})}updateState({props:props,oldProps:oldProps,changeFlags:changeFlags}){if(super.updateState({props:props,oldProps:oldProps,changeFlags:changeFlags}),changeFlags.extensionsChanged){const{gl:gl}=this.context;this.state.model&&this.state.model.delete(),this.setState({model:this._getModel(gl)}),this.getAttributeManager().invalidateAll()}}draw({uniforms:uniforms}){this.state.model.setUniforms(uniforms).draw()}_getModel(gl){return new model.a(gl,Object.assign(this.getShaders(),{id:this.props.id,geometry:new geometry.a({drawMode:esm.a.TRIANGLE_FAN,vertexCount:4,attributes:{positions:{size:3,value:new Float32Array([-1,-1,0,1,-1,0,1,1,0,-1,1,0])}}}),isInstanced:!0}))}}FlowCirclesLayer_FlowCirclesLayer.layerName="FlowCirclesLayer",FlowCirclesLayer_FlowCirclesLayer.defaultProps={getColor:{type:"accessor",value:FlowCirclesLayer_DEFAULT_COLOR},getPosition:{type:"accessor",value:d=>d.position},getRadius:{type:"accessor",value:1},parameters:{depthTest:!1}};var dist_esm_FlowCirclesLayer_FlowCirclesLayer=FlowCirclesLayer_FlowCirclesLayer;class FlowLinesLayer_FlowLinesLayer extends lib_layer.a{constructor(props){super(props)}getShaders(){return super.getShaders({vs:"#define SHADER_NAME flow-line-layer-vertex-shader\n\nattribute vec3 positions;\nattribute vec3 normals;\nattribute vec4 instanceColors;\nattribute float instanceThickness;    // 0..0.5\nattribute vec3 instanceSourcePositions;\nattribute vec3 instanceTargetPositions;\nattribute vec3 instanceSourcePositions64Low;\nattribute vec3 instanceTargetPositions64Low;\nattribute vec3 instancePickingColors;\nattribute vec2 instanceEndpointOffsets;\nattribute float instancePickable;\n\nuniform vec4 outlineColor;\nuniform float thicknessUnit;\nuniform float gap;\nuniform float opacity;\n\nvarying vec4 vColor;\nvarying vec2 uv;\n\nvoid main(void) {\n  geometry.worldPosition = instanceSourcePositions;\n  geometry.worldPositionAlt = instanceTargetPositions;\n  \n  // Position\n  vec4 source_commonspace;    \n  vec4 target_commonspace;\n  vec4 source = project_position_to_clipspace(instanceSourcePositions, instanceSourcePositions64Low, vec3(0.), source_commonspace);\n  vec4 target = project_position_to_clipspace(instanceTargetPositions, instanceTargetPositions64Low, vec3(0.), target_commonspace);\n\n  // linear interpolation of source & target to pick right coord\n  float sourceOrTarget = positions.x;\n  geometry.position = mix(source_commonspace, target_commonspace, sourceOrTarget);\n  uv = positions.xy;\n  geometry.uv = uv;\n  if (instancePickable > 0.5) {\n    geometry.pickingColor = instancePickingColors;\n  }\n  \n  // set the clamp limits in pixel size \n  float lengthCommon = length(target_commonspace - source_commonspace);    \n  vec2 offsetDistances = project_pixel_size(positions.yz) * thicknessUnit;\n  \n  vec2 limitedOffsetDistances = clamp(   \n    project_pixel_size(positions.yz) * thicknessUnit,\n    -lengthCommon*.8, lengthCommon*.8\n  );\n  float startOffsetCommon = project_pixel_size(instanceEndpointOffsets[0]);\n  float endOffsetCommon = project_pixel_size(instanceEndpointOffsets[1]);\n  float endpointOffset = mix(\n    clamp(startOffsetCommon, 0.0, lengthCommon*.2),\n    -clamp(endOffsetCommon, 0.0, lengthCommon*.2),\n    positions.x\n  );\n\n  vec2 flowlineDir = normalize(target_commonspace.xy - source_commonspace.xy);\n  vec2 perpendicularDir = vec2(-flowlineDir.y, flowlineDir.x);\n  vec2 normalsCommon = project_pixel_size(normals.xy);\n  float gapCommon = project_pixel_size(gap);\n  vec3 offsetCommon = vec3(\n    flowlineDir * (instanceThickness * limitedOffsetDistances[1] + normalsCommon.y + endpointOffset * 1.05) -\n    perpendicularDir * (instanceThickness * limitedOffsetDistances[0] + gapCommon + normalsCommon.x),\n    0.0\n  );\n  \n  DECKGL_FILTER_SIZE(offsetCommon, geometry);\n  vec4 position_commonspace = mix(source_commonspace, target_commonspace, sourceOrTarget);\n  vec4 offset_commonspace = vec4(offsetCommon, 0.0);\n  gl_Position = project_common_position_to_clipspace(position_commonspace + offset_commonspace);\n      \n  DECKGL_FILTER_GL_POSITION(gl_Position, geometry);\n  \n  vec4 fillColor = vec4(instanceColors.rgb, instanceColors.a * opacity) / 255.;\n  if (instancePickable <= 0.5) {\n    vColor = mix(fillColor, vec4(outlineColor.xyz, instanceThickness), normals.z);\n  } else {\n    vColor = mix(fillColor, vec4(outlineColor.xyz, outlineColor.w * fillColor.w), normals.z);\n  }\n  DECKGL_FILTER_COLOR(vColor, geometry);\n}\n",fs:"#define SHADER_NAME flow-line-layer-fragment-shader\n\nprecision highp float;\n\nvarying vec4 vColor;\nvarying vec2 uv;\n\nvoid main(void) {\n  if (vColor.a == 0.0) {\n    discard;\n  }\n\n  geometry.uv = uv;\n  gl_FragColor = vColor;\n  DECKGL_FILTER_COLOR(gl_FragColor, geometry);\n}\n",modules:[project32.a,picking.a],shaderCache:this.context.shaderCache})}initializeState(){const{attributeManager:attributeManager}=this.state;attributeManager.addInstanced({instanceSourcePositions:{accessor:"getSourcePosition",size:3,transition:!1,type:esm.a.DOUBLE},instanceTargetPositions:{accessor:"getTargetPosition",size:3,transition:!1,type:esm.a.DOUBLE},instanceThickness:{accessor:"getThickness",size:1,transition:!1},instanceEndpointOffsets:{accessor:"getEndpointOffsets",size:2,transition:!1},instanceColors:{accessor:"getColor",size:4,type:esm.a.UNSIGNED_BYTE,transition:!1},instancePickable:{accessor:"getPickable",size:1,transition:!1}})}updateState({props:props,oldProps:oldProps,changeFlags:changeFlags}){if(super.updateState({props:props,oldProps:oldProps,changeFlags:changeFlags}),changeFlags.extensionsChanged){const{gl:gl}=this.context;this.state.model&&this.state.model.delete(),this.setState({model:this._getModel(gl)}),this.getAttributeManager().invalidateAll()}}draw({uniforms:uniforms}){const{gl:gl}=this.context,{outlineColor:outlineColor,thicknessUnit:thicknessUnit}=this.props;gl.lineWidth(1),this.state.model.setUniforms(Object.assign(Object.assign({},uniforms),{outlineColor:outlineColor.map(x=>x/255),thicknessUnit:2*thicknessUnit,gap:.5})).draw()}_getModel(gl){let positions=[],pixelOffsets=[];const{drawOutline:drawOutline,outlineThickness:outlineThickness}=this.props;if(drawOutline){positions=positions.concat([0,0,0,0,1,0,1,0,0,0,1,0,1,0,-3,1,1,-3,1,0,0,1,2,-3,1,0,-3]);const tout=outlineThickness,tin=1;pixelOffsets=pixelOffsets.concat([-tin,-tout,1,tout,-tout,1,-tin,tout,1,tout,-tout,1,-tin,0,1,tout,0,1,-tin,3*tout,1,2*tout,-tout,1,-tin,-tout,1])}return positions=positions.concat([0,0,0,0,1,0,1,0,0,0,1,0,1,0,-3,1,1,-3,1,0,0,1,2,-3,1,0,-3]),pixelOffsets=pixelOffsets.concat([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]),new model.a(gl,Object.assign(Object.assign({id:this.props.id},this.getShaders()),{geometry:new geometry.a({drawType:esm.a.TRIANGLES,attributes:{positions:new Float32Array(positions),normals:new Float32Array(pixelOffsets)}}),isInstanced:!0,shaderCache:this.context.shaderCache}))}}FlowLinesLayer_FlowLinesLayer.layerName="FlowLinesLayer",FlowLinesLayer_FlowLinesLayer.defaultProps={getSourcePosition:{type:"accessor",value:d=>d.sourcePosition},getTargetPosition:{type:"accessor",value:d=>d.targetPosition},getColor:{type:"accessor",value:[0,132,193,255]},getThickness:{type:"accessor",value:d=>d.thickness},getPickable:{type:"accessor",value:d=>1},drawOutline:!0,thicknessUnit:10,outlineThickness:1,outlineColor:[255,255,255,255],parameters:{depthTest:!1}};var dist_esm_FlowLinesLayer_FlowLinesLayer=FlowLinesLayer_FlowLinesLayer,extent=__webpack_require__(845),max=__webpack_require__(846),ascending=__webpack_require__(231),src=__webpack_require__(434),linear=__webpack_require__(157),pow=__webpack_require__(426),es=__webpack_require__(30),lab=__webpack_require__(842),src_color=__webpack_require__(49),rgb=__webpack_require__(308),sequential=__webpack_require__(855);const DEFAULT_FLOW_COLOR_SCHEME=["rgba(240,240,240,0.5)","#137CBD"],DEFAULT_FLOW_COLOR_SCHEME_POSITIVE=["rgba(240,240,240,0.5)","#f6654e"],DEFAULT_FLOW_COLOR_SCHEME_NEGATIVE=["rgba(240,240,240,0.5)","#00a9cc"],FALLBACK_COLOR_RGBA=[255,255,255,255];function isDiffColorsRGBA(colors){return void 0!==colors.positive}function getBaseColorsRGBA(colors){const darkMode=!(!colors||!colors.darkMode);return{darkMode:darkMode,locationAreas:getLocationAreaColorsRGBA(colors&&colors.locationAreas,darkMode),outlineColor:colorAsRgba(colors&&colors.outlineColor||"#fff"),dimmedOpacity:colors&&null!=colors.dimmedOpacity?colors.dimmedOpacity:.4}}function getColorsRGBA(colors){const baseColorsRGBA=getBaseColorsRGBA(colors);return Object.assign(Object.assign({},baseColorsRGBA),getFlowAndCircleColors(colors,DEFAULT_FLOW_COLOR_SCHEME,baseColorsRGBA.darkMode))}function getDiffColorsRGBA(colors){const baseColorsRGBA=getBaseColorsRGBA(colors);return Object.assign(Object.assign({},baseColorsRGBA),{positive:getFlowAndCircleColors(colors&&colors.positive,DEFAULT_FLOW_COLOR_SCHEME_POSITIVE,baseColorsRGBA.darkMode),negative:getFlowAndCircleColors(colors&&colors.negative,DEFAULT_FLOW_COLOR_SCHEME_NEGATIVE,baseColorsRGBA.darkMode)})}function getLocationAreaColorsRGBA(colors,darkMode){const normalColor=colors&&colors.normal||"rgba(220,220,220,0.5)",normalColorHcl=Object(lab.a)(normalColor),locationAreasNormal=colorAsRgba(normalColor);return{normal:locationAreasNormal,connected:colorAsRgbaOr(colors&&colors.connected,locationAreasNormal),highlighted:colorAsRgbaOr(colors&&colors.highlighted,opacifyHex(normalColorHcl[darkMode?"brighter":"darker"](1).toString(),.5)),selected:colorAsRgbaOr(colors&&colors.selected,opacifyHex(normalColorHcl[darkMode?"brighter":"darker"](2).toString(),.8)),outline:colorAsRgbaOr(colors&&colors.outline,colorAsRgba(normalColorHcl[darkMode?"brighter":"darker"](4).toString()))}}function getFlowAndCircleColors(inputColors,defaultFlowColorScheme,darkMode){const flowColorScheme=inputColors&&inputColors.flows&&inputColors.flows.scheme||defaultFlowColorScheme,maxFlowColorHcl=Object(lab.a)(flowColorScheme[flowColorScheme.length-1]),flowColorHighlighted=colorAsRgbaOr(inputColors&&inputColors.flows&&inputColors.flows.highlighted,colorAsRgba(maxFlowColorHcl[darkMode?"brighter":"darker"](.7).toString()));return{flows:{scheme:flowColorScheme,highlighted:flowColorHighlighted},locationCircles:{inner:colorAsRgbaOr(inputColors&&inputColors.locationCircles&&inputColors.locationCircles.inner,maxFlowColorHcl.toString()),outgoing:colorAsRgbaOr(inputColors&&inputColors.locationCircles&&inputColors.locationCircles.outgoing,darkMode?"#000":"#fff"),incoming:colorAsRgbaOr(inputColors&&inputColors.locationCircles&&inputColors.locationCircles.incoming,maxFlowColorHcl[darkMode?"brighter":"darker"](1.25).toString()),highlighted:colorAsRgbaOr(inputColors&&inputColors.locationCircles&&inputColors.locationCircles.highlighted,flowColorHighlighted)}}}function colorAsRgba(color){const col=Object(src_color.e)(color);if(!col)return console.warn("Invalid color: ",color),FALLBACK_COLOR_RGBA;const rgbColor=col.rgb();return[Math.floor(rgbColor.r),Math.floor(rgbColor.g),Math.floor(rgbColor.b),opacityFloatToInteger(col.opacity)]}function colorAsRgbaOr(color,defaultColor){return color?colorAsRgba(color):"string"==typeof defaultColor?colorAsRgba(defaultColor):defaultColor}function rgbaAsString(color){return`rgba(${color.join(",")})`}function opacifyHex(hexCode,opacity){const c=Object(src_color.e)(hexCode);if(!c)return console.warn("Invalid color: ",hexCode),`rgba(255, 255, 255, ${opacity})`;const col=c.rgb();return`rgba(${col.r}, ${col.g}, ${col.b}, ${opacity})`}function opacityFloatToInteger(opacity){return Math.round(255*opacity)}function getDimmedColor(color,opacity){const col=Object(lab.a)(rgbaAsString(color));if(!col)return console.warn("Invalid color: ",color),FALLBACK_COLOR_RGBA;col.c*=.1;const rgbColor=col.rgb();return[Math.floor(rgbColor.r),Math.floor(rgbColor.g),Math.floor(rgbColor.b),opacityFloatToInteger(void 0!==opacity?opacity:.4)]}function createFlowColorScale(domain,scheme,animate){const scale=Object(sequential.a)(Object(rgb.b)(scheme)).exponent(animate?.5:1/3).domain(domain);return value=>colorAsRgba(scale(value))}function isFeatureCollection(locations){return"FeatureCollection"===locations.type}var PickingType;!function(PickingType){PickingType.LOCATION="location",PickingType.FLOW="flow",PickingType.LOCATION_AREA="location-area"}(PickingType||(PickingType={}));const getDiffMode=props=>props.diffMode,getColorsProp=props=>props.colors,getAnimate=props=>props.animate,getLocationFeatures=props=>isFeatureCollection(props.locations)?props.locations.features:props.locations,getFlows=props=>props.flows,getHighlightedFlow=props=>props.highlightedFlow,getHighlightedLocationId=props=>props.highlightedLocationId,getSelectedLocationIds=props=>props.selectedLocationIds,getShowOnlyTopFlows=props=>props.showOnlyTopFlows,getMaxLocationCircleSize=props=>null!=props.maxLocationCircleSize?props.maxLocationCircleSize:FlowMapLayer_FlowMapLayer.defaultProps.maxLocationCircleSize;var LayerKind,dist_esm_Selectors=class Selectors_Selectors{constructor(inputAccessors){this.inputAccessors=inputAccessors,this.getColors=Object(es.a)([getColorsProp,getDiffMode],(colors,diffMode)=>diffMode?getDiffColorsRGBA(colors):getColorsRGBA(colors)),this.getLocationByIdGetter=Object(es.a)([getLocationFeatures],locations=>{const locationsById=Object(src.a)().key(this.inputAccessors.getLocationId).rollup(([d])=>d).object(locations);return id=>{const location=locationsById[id];return location||console.warn(`No location found for id '${id}'`),location}}),this.getFilteredFlows=Object(es.a)([getFlows,getSelectedLocationIds],(flows,selectedLocationIds)=>{const{getFlowOriginId:getFlowOriginId,getFlowDestId:getFlowDestId}=this.inputAccessors;return selectedLocationIds?flows.filter(flow=>selectedLocationIds.indexOf(getFlowOriginId(flow))>=0||selectedLocationIds.indexOf(getFlowDestId(flow))>=0):flows}),this.getNonSelfFlows=Object(es.a)([this.getFilteredFlows],flows=>{const{getFlowOriginId:getFlowOriginId,getFlowDestId:getFlowDestId}=this.inputAccessors;return flows.filter(flow=>getFlowOriginId(flow)!==getFlowDestId(flow))}),this.getSortedNonSelfFlows=Object(es.a)([this.getNonSelfFlows],flows=>flows.slice().sort((f1,f2)=>Math.abs(this.inputAccessors.getFlowMagnitude(f1))-Math.abs(this.inputAccessors.getFlowMagnitude(f2)))),this.getTopFlows=Object(es.a)([this.getSortedNonSelfFlows,getShowOnlyTopFlows],(flows,showOnlyTopFlows)=>null!=showOnlyTopFlows&&showOnlyTopFlows>0&&flows.length>showOnlyTopFlows?flows.slice(flows.length-showOnlyTopFlows,flows.length):flows),this.getHighlightedFlows=Object(es.a)([this.getSortedNonSelfFlows,getHighlightedFlow,getHighlightedLocationId],(flows,highlightedFlow,highlightedLocationId)=>{const{getFlowOriginId:getFlowOriginId,getFlowDestId:getFlowDestId}=this.inputAccessors;return highlightedFlow?[highlightedFlow]:highlightedLocationId?flows.filter(flow=>getFlowOriginId(flow)===highlightedLocationId||getFlowDestId(flow)===highlightedLocationId):void 0}),this.getFlowMagnitudeExtent=Object(es.a)([this.getNonSelfFlows,props=>props.flowMagnitudeExtent],(flows,flowMagnitudeExtent)=>null!=flowMagnitudeExtent?flowMagnitudeExtent:Object(extent.a)(flows,f=>this.inputAccessors.getFlowMagnitude(f))),this.getFlowThicknessScale=Object(es.a)([this.getFlowMagnitudeExtent],([minMagnitude,maxMagnitude])=>{const scale=Object(linear.a)().range([.05,.5]).domain([0,Math.max(Math.abs(minMagnitude||0),Math.abs(maxMagnitude||0))]);return magnitude=>scale(Math.abs(magnitude))}),this.getFlowColorScale=Object(es.a)([this.getColors,this.getFlowMagnitudeExtent,getAnimate],(colors,[minMagnitude,maxMagnitude],animate)=>{if(isDiffColorsRGBA(colors)){const posScale=createFlowColorScale([0,maxMagnitude||0],colors.positive.flows.scheme,animate),negScale=createFlowColorScale([0,minMagnitude||0],colors.negative.flows.scheme,animate);return magnitude=>magnitude>=0?posScale(magnitude):negScale(magnitude)}const scale=createFlowColorScale([0,maxMagnitude||0],colors.flows.scheme,animate);return magnitude=>scale(magnitude)}),this.getLocationTotals=Object(es.a)([getLocationFeatures,this.getFilteredFlows],(locations,flows)=>{const{getFlowOriginId:getFlowOriginId,getFlowDestId:getFlowDestId,getFlowMagnitude:getFlowMagnitude}=this.inputAccessors;return flows.reduce((acc,curr)=>{const originId=getFlowOriginId(curr),destId=getFlowDestId(curr),magnitude=getFlowMagnitude(curr);return originId===destId?acc.within[originId]=(acc.within[originId]||0)+magnitude:(acc.outgoing[originId]=(acc.outgoing[originId]||0)+magnitude,acc.incoming[destId]=(acc.incoming[destId]||0)+magnitude),acc},{incoming:{},outgoing:{},within:{}})}),this.getHighlightedLocationCircles=Object(es.a)([this.getLocationByIdGetter,getHighlightedLocationId],(getLocationById,highlightedLocationId)=>{if(highlightedLocationId){const location=getLocationById(highlightedLocationId);if(!location)return;return[{location:location,type:"outline"},{location:location,type:"outer"},{location:location,type:"inner"}]}}),this.getLocationTotalInGetter=props=>{const{getLocationTotalIn:getLocationTotalIn,getLocationId:getLocationId}=this.inputAccessors;if(getLocationTotalIn)return getLocationTotalIn;const{incoming:incoming}=this.getLocationTotals(props);return location=>incoming[getLocationId(location)]||0},this.getLocationTotalOutGetter=props=>{const{getLocationTotalOut:getLocationTotalOut,getLocationId:getLocationId}=this.inputAccessors;if(getLocationTotalOut)return getLocationTotalOut;const{outgoing:outgoing}=this.getLocationTotals(props);return location=>outgoing[getLocationId(location)]||0},this.getLocationTotalWithinGetter=props=>{const{getLocationTotalWithin:getLocationTotalWithin,getLocationId:getLocationId}=this.inputAccessors;if(getLocationTotalWithin)return getLocationTotalWithin;const{within:within}=this.getLocationTotals(props);return location=>within[getLocationId(location)]||0},this.getLocationMaxAbsTotalGetter=Object(es.a)([getLocationFeatures,this.getLocationTotalInGetter,this.getLocationTotalOutGetter,this.getLocationTotalWithinGetter],(locations,getLocationTotalIn,getLocationTotalOut,getLocationTotalWithin)=>location=>Math.max(Math.abs(getLocationTotalIn(location)+getLocationTotalWithin(location)),Math.abs(getLocationTotalOut(location)+getLocationTotalWithin(location)))),this.getMaxLocationMaxAbsTotal=Object(es.a)([getLocationFeatures,this.getLocationMaxAbsTotalGetter,props=>props.locationTotalsExtent],(locations,getLocationMaxAbsTotal,locationTotalsExtent)=>null!=locationTotalsExtent?Object(max.a)(locationTotalsExtent,Math.abs)||0:Object(max.a)(locations,getLocationMaxAbsTotal)||0),this.getLocationCircles=Object(es.a)([getLocationFeatures,this.getLocationMaxAbsTotalGetter],(locations,getLocationMaxAbsTotalGetter)=>{const circles=[],sorted=locations.slice().sort((a,b)=>Object(ascending.a)(getLocationMaxAbsTotalGetter(a),getLocationMaxAbsTotalGetter(b)));for(const location of sorted)circles.push({location:location,type:"outline"}),circles.push({location:location,type:"outer"}),circles.push({location:location,type:"inner"});return circles}),this.getSizeScale=Object(es.a)([getMaxLocationCircleSize,this.getMaxLocationMaxAbsTotal],(maxLocationCircleSize,maxTotal)=>{const scale=Object(pow.a)().exponent(.5).domain([0,maxTotal]).range([0,maxTotal>0?maxLocationCircleSize:1]);return v=>scale(Math.abs(v))||0}),this.getLocationCircleRadiusGetter=Object(es.a)([this.getSizeScale,this.getLocationTotalInGetter,this.getLocationTotalOutGetter,this.getLocationTotalWithinGetter],(sizeScale,getLocationTotalIn,getLocationTotalOut,getLocationTotalWithin)=>({location:location,type:type})=>{const getSide="inner"===type?Math.min:Math.max,totalIn=getLocationTotalIn(location),totalOut=getLocationTotalOut(location),totalWithin=getLocationTotalWithin(location),r=sizeScale(getSide(Math.abs(totalIn+totalWithin),Math.abs(totalOut+totalWithin)));return"outline"===type?r+1:r}),this.getLocationCircleColorGetter=Object(es.a)([this.getColors,getHighlightedLocationId,this.getLocationTotalInGetter,this.getLocationTotalOutGetter,this.getLocationTotalWithinGetter],(colors,highlightedLocationId,getLocationTotalIn,getLocationTotalOut,getLocationTotalWithin)=>{const{getLocationId:getLocationId}=this.inputAccessors;return({location:location,type:type})=>{const isHighlighted=highlightedLocationId&&highlightedLocationId===getLocationId(location),isDimmed=highlightedLocationId&&highlightedLocationId!==getLocationId(location),totalWithin=getLocationTotalWithin(location),totalIn=getLocationTotalIn(location)+totalWithin,totalOut=getLocationTotalOut(location)+totalWithin,isIncoming="outer"===type&&Math.abs(totalIn)>Math.abs(totalOut),isPositive=!0===isIncoming&&totalIn>=0||totalOut>=0,circleColors=(isDiffColorsRGBA(colors)?isPositive?colors.positive:colors.negative:colors).locationCircles;return isHighlighted&&"outline"===type?circleColors.highlighted:isDimmed?"outline"===type?function getDimmedCircleOutlineColor(outlineColor,opacity){const[r,g,b,a]=outlineColor;return[r,g,b,a*opacity*.5]}(colors.outlineColor,colors.dimmedOpacity):function getDimmedCircleColor(color,opacity){return getDimmedColor(color,.5*opacity)}(circleColors.inner,colors.dimmedOpacity):"outline"===type?isIncoming?circleColors.incoming:circleColors.inner:"inner"===type?circleColors.inner:!0===isIncoming?circleColors.incoming:circleColors.outgoing}}),this.isLocationConnectedGetter=Object(es.a)([this.getFilteredFlows,getHighlightedLocationId,getHighlightedFlow,getSelectedLocationIds],(flows,highlightedLocationId,highlightedFlow,selectedLocationIds)=>{const{getFlowOriginId:getFlowOriginId,getFlowDestId:getFlowDestId}=this.inputAccessors;if(highlightedLocationId){const isRelated=flow=>{const originId=getFlowOriginId(flow),destId=getFlowDestId(flow);return originId===highlightedLocationId||selectedLocationIds&&selectedLocationIds.indexOf(originId)>=0||destId===highlightedLocationId||selectedLocationIds&&selectedLocationIds.indexOf(destId)>=0},locations=new Set;for(const flow of flows)isRelated(flow)&&(locations.add(getFlowOriginId(flow)),locations.add(getFlowDestId(flow)));return id=>locations.has(id)}return()=>!1}),this.getLocationAreaFillColorGetter=Object(es.a)([this.getColors,getSelectedLocationIds,this.isLocationConnectedGetter],(colors,selectedLocationIds,isLocationConnected)=>location=>{const locationId=this.inputAccessors.getLocationId(location);return selectedLocationIds&&selectedLocationIds.indexOf(locationId)>=0?colors.locationAreas.selected:isLocationConnected(locationId)?colors.locationAreas.connected:colors.locationAreas.normal})}getFlowLinesColorGetter(colors,flowColorScale,highlighted,dimmed){const{getFlowMagnitude:getFlowMagnitude,getFlowColor:getFlowColor}=this.inputAccessors;return flow=>{if(getFlowColor){const color=getFlowColor(flow);if(color)return colorAsRgba(color)}if(highlighted){if(isDiffColorsRGBA(colors)){const positiveColor=colors.positive.flows.highlighted,negativeColor=colors.negative.flows.highlighted;return getFlowMagnitude(flow)>=0?positiveColor:negativeColor}return colors.flows.highlighted}{const magnitude=getFlowMagnitude(flow),color=flowColorScale(magnitude);return dimmed?getDimmedColor(color,colors.dimmedOpacity):color}}}setInputAccessors(inputAccessors){this.inputAccessors=inputAccessors}getInputAccessors(){return this.inputAccessors}};!function(LayerKind){LayerKind.LOCATIONS="LOCATIONS",LayerKind.LOCATION_AREAS="LOCATION_AREAS",LayerKind.LOCATION_AREAS_OUTLINES="LOCATION_AREAS_OUTLINES",LayerKind.LOCATION_AREAS_SELECTED_AND_HIGHLIGHTED="LOCATION_AREAS_SELECTED_AND_HIGHLIGHTED",LayerKind.FLOWS="FLOWS",LayerKind.LOCATIONS_HIGHLIGHTED="LOCATIONS_HIGHLIGHTED",LayerKind.FLOWS_HIGHLIGHTED="FLOWS_HIGHLIGHTED"}(LayerKind||(LayerKind={}));function getLayerId(baseLayerId,layerKind){return`${baseLayerId}:::${layerKind.valueOf()}`}function getPickType({id:id}){switch(function getLayerKind(id){const kind=id.substr(id.lastIndexOf(":::")+":::".length);return LayerKind[kind]}(id)){case LayerKind.FLOWS:case LayerKind.FLOWS_HIGHLIGHTED:return PickingType.FLOW;case LayerKind.LOCATIONS:case LayerKind.LOCATIONS_HIGHLIGHTED:return PickingType.LOCATION;case LayerKind.LOCATION_AREAS:return PickingType.LOCATION_AREA;default:return}}class FlowMapLayer_FlowMapLayer extends composite_layer.a{constructor(props){super(props)}initializeState(){const{getLocationTotalIn:getLocationTotalIn,getLocationTotalOut:getLocationTotalOut,getLocationTotalWithin:getLocationTotalWithin,getLocationId:getLocationId,getLocationCentroid:getLocationCentroid,getFlowOriginId:getFlowOriginId,getFlowDestId:getFlowDestId,getFlowMagnitude:getFlowMagnitude,getFlowColor:getFlowColor}=this.props,selectors=new dist_esm_Selectors({getLocationId:getLocationId,getLocationCentroid:getLocationCentroid,getLocationTotalIn:getLocationTotalIn,getLocationTotalOut:getLocationTotalOut,getLocationTotalWithin:getLocationTotalWithin,getFlowOriginId:getFlowOriginId,getFlowDestId:getFlowDestId,getFlowMagnitude:getFlowMagnitude,getFlowColor:getFlowColor});this.setState({selectors:selectors})}updateState(params){super.updateState(params);const{props:props,changeFlags:changeFlags}=params;if(changeFlags.propsChanged){const{getLocationTotalIn:getLocationTotalIn,getLocationTotalOut:getLocationTotalOut,getLocationTotalWithin:getLocationTotalWithin,getLocationId:getLocationId,getLocationCentroid:getLocationCentroid,getFlowOriginId:getFlowOriginId,getFlowDestId:getFlowDestId,getFlowMagnitude:getFlowMagnitude,getFlowColor:getFlowColor}=props;this.state.selectors.setInputAccessors({getLocationId:getLocationId,getLocationCentroid:getLocationCentroid,getLocationTotalIn:getLocationTotalIn,getLocationTotalOut:getLocationTotalOut,getLocationTotalWithin:getLocationTotalWithin,getFlowOriginId:getFlowOriginId,getFlowDestId:getFlowDestId,getFlowMagnitude:getFlowMagnitude,getFlowColor:getFlowColor})}}getPickingInfo(params){const type=getPickType(params.sourceLayer);if(!type)return params.info;const info=Object.assign(Object.assign({},params.info),{type:type}),{selectors:selectors}=this.state;if(type===PickingType.FLOW){const getLocationById=selectors.getLocationByIdGetter(this.props),{getFlowOriginId:getFlowOriginId,getFlowDestId:getFlowDestId}=selectors.getInputAccessors(),flow=info.object;return Object.assign(Object.assign({},info),flow&&{origin:getLocationById(getFlowOriginId(flow)),dest:getLocationById(getFlowDestId(flow))})}if(type===PickingType.LOCATION||type===PickingType.LOCATION_AREA){const location=type===PickingType.LOCATION?info.object&&info.object.location:info.object,getLocationTotalIn=selectors.getLocationTotalInGetter(this.props),getLocationTotalOut=selectors.getLocationTotalOutGetter(this.props),getLocationTotalWithin=selectors.getLocationTotalWithinGetter(this.props),getLocationCircleRadius=selectors.getLocationCircleRadiusGetter(this.props);return Object.assign(Object.assign({},info),location&&{object:location,totalIn:getLocationTotalIn(location),totalOut:getLocationTotalOut(location),totalWithin:getLocationTotalWithin(location),circleRadius:getLocationCircleRadius({location:location,type:"outer"})})}return info}renderLayers(){const{showLocationAreas:showLocationAreas,locations:locations,highlightedLocationId:highlightedLocationId}=this.props,{selectors:selectors}=this.state,topFlows=selectors.getTopFlows(this.props),highlightedFlows=selectors.getHighlightedFlows(this.props),isLocationHighlighted=null!=highlightedLocationId,locationCircles=selectors.getLocationCircles(this.props),layers=[];if(showLocationAreas&&isFeatureCollection(locations)&&layers.push(this.getLocationAreasLayer(getLayerId(this.props.id,LayerKind.LOCATION_AREAS),!1)),layers.push(this.getFlowLinesLayer(getLayerId(this.props.id,LayerKind.FLOWS),topFlows,!1,isLocationHighlighted)),showLocationAreas&&isFeatureCollection(locations)&&layers.push(this.getHighlightedLocationAreasLayer(getLayerId(this.props.id,LayerKind.LOCATION_AREAS_SELECTED_AND_HIGHLIGHTED))),highlightedFlows&&layers.push(this.getFlowLinesLayer(getLayerId(this.props.id,LayerKind.FLOWS_HIGHLIGHTED),highlightedFlows,!0,!1)),layers.push(this.getLocationCirclesLayer(getLayerId(this.props.id,LayerKind.LOCATIONS),locationCircles,!1)),isLocationHighlighted){const highlightedLocationCircles=selectors.getHighlightedLocationCircles(this.props);layers.push(this.getLocationCirclesLayer(getLayerId(this.props.id,LayerKind.LOCATIONS_HIGHLIGHTED),highlightedLocationCircles,!0))}return showLocationAreas&&isFeatureCollection(locations)&&layers.push(this.getLocationAreasLayer(getLayerId(this.props.id,LayerKind.LOCATION_AREAS_OUTLINES),!0)),layers}getLocationAreasLayer(id,outline){const{locations:locations,selectedLocationIds:selectedLocationIds,highlightedLocationId:highlightedLocationId,highlightedFlow:highlightedFlow,updateTriggers:updateTriggers}=this.props,{selectors:selectors}=this.state,colors=selectors.getColors(this.props);return new geojson_layer.a(this.getSubLayerProps(Object.assign(Object.assign({id:id,getFillColor:selectors.getLocationAreaFillColorGetter(this.props),getLineColor:colors.locationAreas.outline,lineJointRounded:!0,data:locations,stroked:outline,filled:!outline},outline&&{pickable:!1}),{lineWidthMinPixels:1,pointRadiusMinPixels:1,updateTriggers:{getFillColor:Object.assign(Object.assign({colors:colors},outline&&{selectedLocationIds:selectedLocationIds,highlightedLocationId:highlightedLocationId,highlightedFlow:highlightedFlow}),null==updateTriggers?void 0:updateTriggers.getLocationAreasFillColor),getLineColor:Object.assign({colors:colors},null==updateTriggers?void 0:updateTriggers.getLocationAreasLineColor)}})))}getHighlightedLocationAreasLayer(id){const{selectors:selectors}=this.state,{highlightedLocationId:highlightedLocationId,highlightedLocationAreaId:highlightedLocationAreaId,updateTriggers:updateTriggers}=this.props,colors=selectors.getColors(this.props),getLocationById=selectors.getLocationByIdGetter(this.props);return new geojson_layer.a(this.getSubLayerProps({id:id,getFillColor:()=>colors.locationAreas.highlighted,getLineColor:colors.locationAreas.outline,lineJointRounded:!0,data:highlightedLocationId?getLocationById(highlightedLocationId):highlightedLocationAreaId?getLocationById(highlightedLocationAreaId):void 0,stroked:!1,filled:!0,pickable:!1,lineWidthMinPixels:5,updateTriggers:{getFillColor:Object.assign({colors:colors},null==updateTriggers?void 0:updateTriggers.getLocationAreasFillColor),getLineColor:Object.assign({colors:colors},null==updateTriggers?void 0:updateTriggers.getLocationAreasLineColor)}}))}getFlowLinesLayer(id,flows,highlighted,dimmed){const{getFlowOriginId:getFlowOriginId,getFlowDestId:getFlowDestId,getFlowMagnitude:getFlowMagnitude,getLocationCentroid:getLocationCentroid,getAnimatedFlowLineStaggering:getAnimatedFlowLineStaggering,showTotals:showTotals,maxLocationCircleSize:maxLocationCircleSize,outlineThickness:outlineThickness,minPickableFlowThickness:minPickableFlowThickness,maxFlowThickness:maxFlowThickness,flowMagnitudeExtent:flowMagnitudeExtent,locationTotalsExtent:locationTotalsExtent,updateTriggers:updateTriggers}=this.props,{selectors:selectors}=this.state,endpointOffsets=[(maxLocationCircleSize||0)+1,(maxLocationCircleSize||0)+1],getLocationRadius=selectors.getLocationCircleRadiusGetter(this.props),getLocationById=selectors.getLocationByIdGetter(this.props),flowThicknessScale=selectors.getFlowThicknessScale(this.props),getThickness=(flow,info)=>flowThicknessScale(getFlowMagnitude(flow,info)),flowColorScale=selectors.getFlowColorScale(this.props),colors=selectors.getColors(this.props),getColor=selectors.getFlowLinesColorGetter(colors,flowColorScale,highlighted,dimmed),{animate:animate}=this.props,thicknessUnit=null!=maxFlowThickness?maxFlowThickness:dist_esm_FlowLinesLayer_FlowLinesLayer.defaultProps.thicknessUnit,baseProps=Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({id:id,getSourcePosition:(flow,info)=>getLocationCentroid(getLocationById(getFlowOriginId(flow,info))),getTargetPosition:(flow,info)=>getLocationCentroid(getLocationById(getFlowDestId(flow,info))),getThickness:getThickness,getEndpointOffsets:(flow,info)=>showTotals?[getLocationRadius({location:getLocationById(getFlowOriginId(flow,info)),type:"outline"}),getLocationRadius({location:getLocationById(getFlowDestId(flow,info)),type:"outline"})]:endpointOffsets,getColor:getColor,data:flows},highlighted&&{pickable:!1}),{drawOutline:!dimmed,updateTriggers:{getSourcePosition:null==updateTriggers?void 0:updateTriggers.getFlowLinesSourcePosition,getTargetPosition:null==updateTriggers?void 0:updateTriggers.getFlowLinesTargetPosition,getThickness:Object.assign({flowMagnitudeExtent:flowMagnitudeExtent,maxFlowThickness:maxFlowThickness},null==updateTriggers?void 0:updateTriggers.getFlowLinesThickness),getColor:Object.assign({colors:colors,dimmed:dimmed},null==updateTriggers?void 0:updateTriggers.getFlowLinesColor),getEndpointOffsets:Object.assign({showTotals:showTotals,locationTotalsExtent:locationTotalsExtent},null==updateTriggers?void 0:updateTriggers.getFlowLinesEndpointOffsets)},thicknessUnit:thicknessUnit,outlineColor:colors.outlineColor}),outlineThickness&&{outlineThickness:outlineThickness}),null!=minPickableFlowThickness&&{getPickable:f=>thicknessUnit*getThickness(f)>=minPickableFlowThickness?1:0}),{parameters:Object.assign(Object.assign({},this.props.parameters),{depthTest:!1})});return animate?new AnimatedFlowLinesLayer_AnimatedFlowLinesLayer(this.getSubLayerProps(Object.assign(Object.assign(Object.assign(Object.assign({},baseProps),{currentTime:this.props.animationCurrentTime}),null!=this.props.animationTailLength&&{animationTailLength:this.props.animationTailLength}),getAnimatedFlowLineStaggering&&{getStaggering:getAnimatedFlowLineStaggering}))):new dist_esm_FlowLinesLayer_FlowLinesLayer(this.getSubLayerProps(baseProps))}getLocationCirclesLayer(id,circles,highlighted){const{highlightedLocationId:highlightedLocationId,selectedLocationIds:selectedLocationIds,getLocationCentroid:getLocationCentroid,flows:flows,showTotals:showTotals,updateTriggers:updateTriggers,maxLocationCircleSize:maxLocationCircleSize,locationTotalsExtent:locationTotalsExtent}=this.props,{selectors:selectors}=this.state,getRadius=showTotals?selectors.getLocationCircleRadiusGetter(this.props):()=>maxLocationCircleSize,colors=selectors.getColors(this.props),getColor=selectors.getLocationCircleColorGetter(this.props);return new dist_esm_FlowCirclesLayer_FlowCirclesLayer(this.getSubLayerProps({id:id,getColor:getColor,getPosition:locCircle=>getLocationCentroid(locCircle.location),getRadius:getRadius,data:circles,updateTriggers:{getRadius:Object.assign({showTotals:showTotals,selectedLocationIds:selectedLocationIds,maxLocationCircleSize:maxLocationCircleSize,locationTotalsExtent:locationTotalsExtent,flows:flows},null==updateTriggers?void 0:updateTriggers.getCirclesRadius),getColor:Object.assign({colors:colors,highlightedLocationId:highlightedLocationId,selectedLocationIds:selectedLocationIds,flows:flows},null==updateTriggers?void 0:updateTriggers.getCirclesColor)},parameters:Object.assign(Object.assign({},this.props.parameters),{depthTest:!1})}))}}FlowMapLayer_FlowMapLayer.layerName="FlowMapLayer",FlowMapLayer_FlowMapLayer.defaultProps={getLocationId:{type:"accessor",value:l=>l.id||l.properties.id},getLocationCentroid:{type:"accessor",value:l=>l.properties.centroid},getFlowOriginId:{type:"accessor",value:f=>f.origin},getFlowDestId:{type:"accessor",value:f=>f.dest},getFlowMagnitude:{type:"accessor",value:f=>f.count},showTotals:!0,maxLocationCircleSize:15,outlineThickness:1,showLocationAreas:!0,animationTailLength:.7};__webpack_exports__.default=FlowMapLayer_FlowMapLayer},408:function(module,exports,__webpack_require__){"use strict";(function(module){var __assign=this&&this.__assign||function(){return(__assign=Object.assign||function(t){for(var s,i=1,n=arguments.length;i<n;i++)for(var p in s=arguments[i])Object.prototype.hasOwnProperty.call(s,p)&&(t[p]=s[p]);return t}).apply(this,arguments)},__createBinding=this&&this.__createBinding||(Object.create?function(o,m,k,k2){void 0===k2&&(k2=k),Object.defineProperty(o,k2,{enumerable:!0,get:function(){return m[k]}})}:function(o,m,k,k2){void 0===k2&&(k2=k),o[k2]=m[k]}),__setModuleDefault=this&&this.__setModuleDefault||(Object.create?function(o,v){Object.defineProperty(o,"default",{enumerable:!0,value:v})}:function(o,v){o.default=v}),__importStar=this&&this.__importStar||function(mod){if(mod&&mod.__esModule)return mod;var result={};if(null!=mod)for(var k in mod)"default"!==k&&Object.prototype.hasOwnProperty.call(mod,k)&&__createBinding(result,mod,k);return __setModuleDefault(result,mod),result},__importDefault=this&&this.__importDefault||function(mod){return mod&&mod.__esModule?mod:{default:mod}};Object.defineProperty(exports,"__esModule",{value:!0});var core_1=__importDefault(__webpack_require__(26)),react_1=__importStar(__webpack_require__(419)),react_2=__webpack_require__(225),d3scaleChromatic=__importStar(__webpack_require__(829)),react_3=__importDefault(__webpack_require__(0)),index_1=__webpack_require__(414),pipe_1=__importDefault(__webpack_require__(415)),withFetch_1=__webpack_require__(416),withStats_1=__importDefault(__webpack_require__(825)),ClusteringExample_1=__importDefault(__webpack_require__(827)),withSheetsFetch_1=__importDefault(__webpack_require__(828)),Example_1=__importDefault(__webpack_require__(417)),react_4=__webpack_require__(418),react_map_gl_1=__webpack_require__(303),getLocationId=function(loc){return loc.properties.abbr},DARK_COLORS={darkMode:!0,flows:{scheme:["rgb(0, 22, 61)","rgb(0, 27, 62)","rgb(0, 36, 68)","rgb(0, 48, 77)","rgb(3, 65, 91)","rgb(48, 87, 109)","rgb(85, 115, 133)","rgb(129, 149, 162)","rgb(179, 191, 197)","rgb(240, 240, 240)"]},locationAreas:{normal:"#334"},outlineColor:"#000"};react_2.storiesOf("Basic",module).add("basic as layer",pipe_1.default(withStats_1.default,withFetch_1.withFetchJson("locations","./data/locations.json"),withFetch_1.withFetchJson("flows","./data/flows-2016.json"))((function(_a){var locations=_a.locations,flows=_a.flows,flowMapLayer=new core_1.default({id:"flow-map-layer",locations:locations,flows:flows,getLocationId:function(loc){return loc.properties.abbr},getFlowMagnitude:function(f){return f.count}});return react_3.default.createElement(react_4.DeckGL,{style:{mixBlendMode:"multiply"},controller:!0,initialViewState:react_1.getViewStateForFeatures(locations,[window.innerWidth,window.innerHeight]),layers:[flowMapLayer]},react_3.default.createElement(react_map_gl_1.StaticMap,{mapboxApiAccessToken:index_1.mapboxAccessToken,width:"100%",height:"100%"}))}))).add("basic as interactive component",pipe_1.default(withStats_1.default,withFetch_1.withFetchJson("locations","./data/locations.json"),withFetch_1.withFetchJson("flows","./data/flows-2016.json"))((function(_a){var locations=_a.locations,flows=_a.flows;return react_3.default.createElement(react_3.default.Fragment,null,react_3.default.createElement(react_1.default,{pickable:!0,getLocationId:getLocationId,flows:flows,locations:locations,initialViewState:react_1.getViewStateForFeatures(locations,[window.innerWidth,window.innerHeight]),mapboxAccessToken:index_1.mapboxAccessToken}),react_3.default.createElement(react_1.LegendBox,{bottom:35,left:10},react_3.default.createElement(react_1.LocationTotalsLegend,null)))}))).add("custom flow color scheme",pipe_1.default(withStats_1.default,withFetch_1.withFetchJson("locations","./data/locations.json"),withFetch_1.withFetchJson("flows","./data/flows-2016.json"))((function(_a){var locations=_a.locations,flows=_a.flows,colors={flows:{scheme:d3scaleChromatic.schemeGnBu[d3scaleChromatic.schemeGnBu.length-1]}};return react_3.default.createElement(react_3.default.Fragment,null,react_3.default.createElement(react_1.default,{pickable:!0,colors:colors,getLocationId:getLocationId,flows:flows,locations:locations,initialViewState:react_1.getViewStateForFeatures(locations,[window.innerWidth,window.innerHeight]),mapboxAccessToken:index_1.mapboxAccessToken}),react_3.default.createElement(react_1.LegendBox,{bottom:35,left:10},react_3.default.createElement(react_1.LocationTotalsLegend,{colors:colors})))}))).add("two layers",pipe_1.default(withStats_1.default,withFetch_1.withFetchJson("locations","./data/locations.json"),withFetch_1.withFetchJson("flows","./data/flows-2016.json"))((function(_a){var locations=_a.locations,flows=_a.flows;return react_3.default.createElement(react_4.DeckGL,{style:{mixBlendMode:"multiply"},controller:!0,initialViewState:react_1.getViewStateForFeatures(locations,[window.innerWidth,window.innerHeight]),layers:[new core_1.default({id:"flow-map-layer-1",colors:{flows:{scheme:d3scaleChromatic.schemeReds[d3scaleChromatic.schemeReds.length-1]}},showLocationAreas:!1,locations:locations,flows:flows.filter((function(f){return"GE"===f.origin})),getLocationId:getLocationId}),new core_1.default({id:"flow-map-layer-2",colors:{flows:{scheme:d3scaleChromatic.schemeBlues[d3scaleChromatic.schemeBlues.length-1]}},locations:locations,showLocationAreas:!1,flows:flows.filter((function(f){return"ZH"===f.origin})),getLocationId:getLocationId})]},react_3.default.createElement(react_map_gl_1.StaticMap,{mapboxApiAccessToken:index_1.mapboxAccessToken,width:"100%",height:"100%"}))}))).add("bearing pitch",pipe_1.default(withStats_1.default,withFetch_1.withFetchJson("locations","./data/locations.json"),withFetch_1.withFetchJson("flows","./data/flows-2016.json"))((function(_a){var locations=_a.locations,flows=_a.flows,viewport=react_1.getViewStateForFeatures(locations,[window.innerWidth,window.innerHeight]);return react_3.default.createElement(react_3.default.Fragment,null,react_3.default.createElement(react_1.default,{pickable:!0,mixBlendMode:"multiply",getLocationId:getLocationId,flows:flows,locations:locations,showLocationAreas:!1,initialViewState:__assign(__assign({},viewport),{altitude:1.5,bearing:40,pitch:50,zoom:1.1*viewport.zoom}),mapboxAccessToken:index_1.mapboxAccessToken}),react_3.default.createElement(react_1.LegendBox,{bottom:35,left:10},react_3.default.createElement(react_1.LocationTotalsLegend,{colors:DARK_COLORS})))}))).add("dark mode",pipe_1.default(withStats_1.default,withFetch_1.withFetchJson("locations","./data/locations.json"),withFetch_1.withFetchJson("flows","./data/flows-2016.json"))((function(_a){var locations=_a.locations,flows=_a.flows;return react_3.default.createElement(react_3.default.Fragment,null,react_3.default.createElement(react_1.default,{pickable:!0,colors:DARK_COLORS,mapStyle:"mapbox://styles/mapbox/dark-v10",mixBlendMode:"screen",getLocationId:getLocationId,flows:flows,locations:locations,showLocationAreas:!1,initialViewState:react_1.getViewStateForFeatures(locations,[window.innerWidth,window.innerHeight]),mapboxAccessToken:index_1.mapboxAccessToken}),react_3.default.createElement(react_1.LegendBox,{bottom:35,left:10,style:{backgroundColor:"#000",color:"#fff"}},react_3.default.createElement(react_1.LocationTotalsLegend,{colors:DARK_COLORS})))}))).add("custom dark mode color scheme",pipe_1.default(withStats_1.default,withFetch_1.withFetchJson("locations","./data/locations.json"),withFetch_1.withFetchJson("flows","./data/flows-2016.json"))((function(_a){var locations=_a.locations,flows=_a.flows,colors={darkMode:!0,flows:{scheme:d3scaleChromatic.schemeGnBu[d3scaleChromatic.schemeGnBu.length-1].slice().reverse()},locationAreas:{normal:"#334"},outlineColor:"#000"};return react_3.default.createElement(react_3.default.Fragment,null,react_3.default.createElement(react_1.default,{pickable:!0,colors:colors,mapStyle:"mapbox://styles/mapbox/dark-v10",mixBlendMode:"screen",getLocationId:getLocationId,flows:flows,locations:locations,initialViewState:react_1.getViewStateForFeatures(locations,[window.innerWidth,window.innerHeight]),mapboxAccessToken:index_1.mapboxAccessToken}),react_3.default.createElement(react_1.LegendBox,{bottom:35,left:10,style:{backgroundColor:"#000",color:"#fff"}},react_3.default.createElement(react_1.LocationTotalsLegend,{colors:colors})))}))).add("animated",pipe_1.default(withStats_1.default,withFetch_1.withFetchJson("locations","./data/locations.json"),withFetch_1.withFetchJson("flows","./data/flows-2016.json"))((function(_a){var locations=_a.locations,flows=_a.flows;return react_3.default.createElement(react_1.default,{pickable:!0,animate:!0,getLocationId:getLocationId,flows:flows,locations:locations,initialViewState:react_1.getViewStateForFeatures(locations,[window.innerWidth,window.innerHeight]),mapboxAccessToken:index_1.mapboxAccessToken})}))).add("animationTailLength",pipe_1.default(withStats_1.default,withFetch_1.withFetchJson("locations","./data/locations.json"),withFetch_1.withFetchJson("flows","./data/flows-2016.json"))((function(_a){var locations=_a.locations,flows=_a.flows,_b=react_3.default.useState(.7),animationTailLength=_b[0],setAnimationTailLength=_b[1];return react_3.default.createElement(react_3.default.Fragment,null,react_3.default.createElement(react_1.default,{pickable:!0,getLocationId:getLocationId,flows:flows,animate:!0,animationTailLength:animationTailLength,locations:locations,initialViewState:react_1.getViewStateForFeatures(locations,[window.innerWidth,window.innerHeight]),mapboxAccessToken:index_1.mapboxAccessToken}),react_3.default.createElement(react_1.LegendBox,{bottom:35,left:10},react_3.default.createElement(react_1.LocationTotalsLegend,null)),react_3.default.createElement(react_1.LegendBox,{top:10,right:10},react_3.default.createElement("label",null,"Tail length:"),react_3.default.createElement("input",{type:"range",value:animationTailLength,min:0,max:1,step:.01,onChange:function(evt){return setAnimationTailLength(+evt.currentTarget.value)}})))}))).add("zoom > 12",pipe_1.default(withStats_1.default,withFetch_1.withFetchJson("locations","./data/locations.json"),withFetch_1.withFetchJson("flows","./data/flows-2016.json"))((function(_a){var locations=_a.locations,flows=_a.flows;return react_3.default.createElement(react_1.default,{pickable:!0,getLocationId:getLocationId,showTotals:!0,showLocationAreas:!0,flows:flows,locations:locations,initialViewState:__assign(__assign({},react_1.getViewStateForFeatures(locations,[window.innerWidth,window.innerHeight])),{zoom:13,longitude:8.645888,latitude:47.411184}),mapboxAccessToken:index_1.mapboxAccessToken})}))).add("only top 100 flows",pipe_1.default(withStats_1.default,withFetch_1.withFetchJson("locations","./data/locations.json"),withFetch_1.withFetchJson("flows","./data/flows-2016.json"))((function(_a){var locations=_a.locations,flows=_a.flows;return react_3.default.createElement(react_1.default,{pickable:!0,getLocationId:getLocationId,showTotals:!0,showOnlyTopFlows:100,showLocationAreas:!0,flows:flows,locations:locations,initialViewState:react_1.getViewStateForFeatures(locations,[window.innerWidth,window.innerHeight]),mapboxAccessToken:index_1.mapboxAccessToken})}))).add("no location areas",pipe_1.default(withStats_1.default,withFetch_1.withFetchJson("locations","./data/locations.json"),withFetch_1.withFetchJson("flows","./data/flows-2016.json"))((function(_a){var locations=_a.locations,flows=_a.flows;return react_3.default.createElement(react_1.default,{pickable:!0,colors:{outlineColor:"#fff"},getLocationId:getLocationId,showTotals:!0,showLocationAreas:!1,flows:flows,locations:locations,initialViewState:react_1.getViewStateForFeatures(locations,[window.innerWidth,window.innerHeight]),mapboxAccessToken:index_1.mapboxAccessToken})}))).add("no location totals",pipe_1.default(withStats_1.default,withFetch_1.withFetchJson("locations","./data/locations.json"),withFetch_1.withFetchJson("flows","./data/flows-2016.json"))((function(_a){var locations=_a.locations,flows=_a.flows;return react_3.default.createElement(react_1.default,{pickable:!0,getLocationId:getLocationId,showTotals:!1,showLocationAreas:!0,flows:flows,locations:locations,maxLocationCircleSize:3,initialViewState:react_1.getViewStateForFeatures(locations,[window.innerWidth,window.innerHeight]),mapboxAccessToken:index_1.mapboxAccessToken})}))).add("custom zone totals",pipe_1.default(withStats_1.default,withFetch_1.withFetchJson("locations","./data/locations.json"),withFetch_1.withFetchJson("flows","./data/flows-2016.json"))((function(_a){var locations=_a.locations,flows=_a.flows,locationIds=locations.features.map(getLocationId).reverse(),getTotal=function(location){return Math.pow(locationIds.indexOf(getLocationId(location)),10)};return react_3.default.createElement(react_3.default.Fragment,null,react_3.default.createElement(react_1.default,{pickable:!0,getLocationId:getLocationId,flows:flows,locations:locations,getLocationTotalIn:getTotal,getLocationTotalOut:getTotal,getLocationTotalWithin:getTotal,initialViewState:react_1.getViewStateForFeatures(locations,[window.innerWidth,window.innerHeight]),mapboxAccessToken:index_1.mapboxAccessToken}),react_3.default.createElement(react_1.LegendBox,{bottom:35,left:10},react_3.default.createElement(react_1.LocationTotalsLegend,null)))}))).add("flow color override",pipe_1.default(withStats_1.default,withFetch_1.withFetchJson("locations","./data/locations.json"),withFetch_1.withFetchJson("flows","./data/flows-2016.json"))((function(_a){var locations=_a.locations,flows=_a.flows;return react_3.default.createElement(react_1.default,{pickable:!0,getLocationId:getLocationId,flows:flows,locations:locations,initialViewState:react_1.getViewStateForFeatures(locations,[window.innerWidth,window.innerHeight]),mapboxAccessToken:index_1.mapboxAccessToken,getFlowColor:function(f){if("ZH"===f.origin&&"AG"===f.dest)return"orange"}})}))).add("custom outlines",pipe_1.default(withStats_1.default,withFetch_1.withFetchJson("locations","./data/locations.json"),withFetch_1.withFetchJson("flows","./data/flows-2016.json"))((function(_a){var locations=_a.locations,flows=_a.flows;return react_3.default.createElement(react_1.default,{pickable:!0,colors:{outlineColor:"#64e9f9"},getLocationId:getLocationId,showTotals:!0,showLocationAreas:!0,flows:flows,locations:locations,initialViewState:react_1.getViewStateForFeatures(locations,[window.innerWidth,window.innerHeight]),outlineThickness:5,mapboxAccessToken:index_1.mapboxAccessToken})}))).add("maxLocationCircleSize",pipe_1.default(withStats_1.default,withFetch_1.withFetchJson("locations","./data/locations.json"),withFetch_1.withFetchJson("flows","./data/flows-2016.json"))((function(_a){var locations=_a.locations,flows=_a.flows;return react_3.default.createElement(react_1.default,{pickable:!0,getLocationId:getLocationId,showTotals:!0,showLocationAreas:!0,flows:flows,locations:locations,initialViewState:react_1.getViewStateForFeatures(locations,[window.innerWidth,window.innerHeight]),maxLocationCircleSize:30,mapboxAccessToken:index_1.mapboxAccessToken})}))).add("multiselect",pipe_1.default(withStats_1.default,withFetch_1.withFetchJson("locations","./data/locations.json"),withFetch_1.withFetchJson("flows","./data/flows-2016.json"))((function(_a){var locations=_a.locations,flows=_a.flows;return react_3.default.createElement(react_1.default,{pickable:!0,getLocationId:getLocationId,flows:flows,locations:locations,multiselect:!0,initialViewState:react_1.getViewStateForFeatures(locations,[window.innerWidth,window.innerHeight]),mapboxAccessToken:index_1.mapboxAccessToken})}))).add("non-pickable",pipe_1.default(withStats_1.default,withFetch_1.withFetchJson("locations","./data/locations.json"),withFetch_1.withFetchJson("flows","./data/flows-2016.json"))((function(_a){var locations=_a.locations,flows=_a.flows;return react_3.default.createElement(react_3.default.Fragment,null,react_3.default.createElement(react_1.default,{pickable:!1,getLocationId:getLocationId,flows:flows,locations:locations,initialViewState:react_1.getViewStateForFeatures(locations,[window.innerWidth,window.innerHeight]),mapboxAccessToken:index_1.mapboxAccessToken}),react_3.default.createElement(react_1.LegendBox,{bottom:35,left:10},react_3.default.createElement(react_1.LocationTotalsLegend,null)))}))).add("basic",pipe_1.default(withStats_1.default,withFetch_1.withFetchJson("locations","./data/locations.json"),withFetch_1.withFetchJson("flows","./data/flows-2016.json"))((function(_a){var locations=_a.locations,flows=_a.flows;return react_3.default.createElement(react_3.default.Fragment,null,react_3.default.createElement(react_1.default,{pickable:!0,getLocationId:getLocationId,flows:flows,locations:locations,initialViewState:react_1.getViewStateForFeatures(locations,[window.innerWidth,window.innerHeight]),mapboxAccessToken:index_1.mapboxAccessToken}),react_3.default.createElement(react_1.LegendBox,{bottom:35,left:10},react_3.default.createElement(react_1.LocationTotalsLegend,null)))}))).add("difference mode",pipe_1.default(withStats_1.default,withFetch_1.withFetchJson("locations","./data/locations.json"),withFetch_1.withFetchJson("flows","./data/flows-diff-2015-2016.json"))((function(_a){var locations=_a.locations,flows=_a.flows;return react_3.default.createElement(react_3.default.Fragment,null,react_3.default.createElement(react_1.default,{pickable:!0,diffMode:!0,getLocationId:getLocationId,showTotals:!0,showLocationAreas:!0,flows:flows,locations:locations,initialViewState:react_1.getViewStateForFeatures(locations,[window.innerWidth,window.innerHeight]),mapboxAccessToken:index_1.mapboxAccessToken}),react_3.default.createElement(react_1.LegendBox,{bottom:35,left:10},react_3.default.createElement(react_1.DiffColorsLegend,null),react_3.default.createElement("hr",null),react_3.default.createElement(react_1.LocationTotalsLegend,{diff:!0})))}))).add("custom legend",(function(){return react_3.default.createElement(react_3.default.Fragment,null,react_3.default.createElement(react_1.LegendBox,{bottom:35,left:10},react_3.default.createElement(react_1.DiffColorsLegend,{positiveText:"+ diff",negativeText:"- diff"}),react_3.default.createElement("hr",null),react_3.default.createElement(react_1.LocationTotalsLegend,{diff:!0,aboutEqualText:"equal",moreOutgoingText:"> outgoing",moreIncomingText:"> incoming"})))})).add("opacity",pipe_1.default(withStats_1.default,withFetch_1.withFetchJson("locations","./data/locations.json"),withFetch_1.withFetchJson("flows","./data/flows-2016.json"))((function(_a){var locations=_a.locations,flows=_a.flows,_b=react_3.default.useState(.5),opacity=_b[0],setOpacity=_b[1];return react_3.default.createElement(react_3.default.Fragment,null,react_3.default.createElement(react_1.default,{pickable:!0,getLocationId:getLocationId,opacity:opacity,flows:flows,animate:!1,locations:locations,initialViewState:react_1.getViewStateForFeatures(locations,[window.innerWidth,window.innerHeight]),mapboxAccessToken:index_1.mapboxAccessToken}),react_3.default.createElement(react_1.LegendBox,{bottom:35,left:10},react_3.default.createElement(react_1.LocationTotalsLegend,null)),react_3.default.createElement(react_1.LegendBox,{top:10,right:10},react_3.default.createElement("label",null,"Opacity:"),react_3.default.createElement("input",{type:"range",value:opacity,min:0,max:1,step:.05,onChange:function(evt){return setOpacity(+evt.currentTarget.value)}})))}))).add("maxFlowThickness",pipe_1.default(withStats_1.default,withFetch_1.withFetchJson("locations","./data/locations.json"),withFetch_1.withFetchJson("flows","./data/flows-2016.json"))((function(_a){var locations=_a.locations,flows=_a.flows,_b=react_3.default.useState(15),thickness=_b[0],setThickness=_b[1];return react_3.default.createElement(react_3.default.Fragment,null,react_3.default.createElement(react_1.default,{pickable:!0,getLocationId:getLocationId,maxFlowThickness:thickness,flows:flows,animate:!1,locations:locations,initialViewState:react_1.getViewStateForFeatures(locations,[window.innerWidth,window.innerHeight]),mapboxAccessToken:index_1.mapboxAccessToken}),react_3.default.createElement(react_1.LegendBox,{bottom:35,left:10},react_3.default.createElement(react_1.LocationTotalsLegend,null)),react_3.default.createElement(react_1.LegendBox,{top:10,right:10},react_3.default.createElement("label",null,"Thickness:"),react_3.default.createElement("input",{type:"range",value:thickness,min:0,max:30,onChange:function(evt){return setThickness(+evt.currentTarget.value)}})))}))).add("flowMagnitudeExtent, locationTotalsExtent",pipe_1.default(withStats_1.default,withFetch_1.withFetchJson("locations","./data/locations.json"),withFetch_1.withFetchJson("flows","./data/flows-2016.json"))((function(_a){var locations=_a.locations,flows=_a.flows,_b=react_3.default.useState(1e4),maxFlowMagnitude=_b[0],setMaxFlowMagnitude=_b[1],flowMagnitudeExtent=[0,maxFlowMagnitude],_c=react_3.default.useState(5e5),maxLocationTotal=_c[0],setMaxLocationTotal=_c[1],locationTotalsExtent=[0,maxLocationTotal];return react_3.default.createElement(react_3.default.Fragment,null,react_3.default.createElement(react_1.default,{pickable:!0,getLocationId:getLocationId,flowMagnitudeExtent:flowMagnitudeExtent,locationTotalsExtent:locationTotalsExtent,flows:flows,animate:!1,locations:locations,initialViewState:react_1.getViewStateForFeatures(locations,[window.innerWidth,window.innerHeight]),mapboxAccessToken:index_1.mapboxAccessToken}),react_3.default.createElement(react_1.LegendBox,{bottom:35,left:10},react_3.default.createElement(react_1.LocationTotalsLegend,null)),react_3.default.createElement(react_1.LegendBox,{top:10,right:10,style:{maxWidth:320}},react_3.default.createElement("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr"}},react_3.default.createElement("label",null,"flowMagnitudeExtent[1]:"),react_3.default.createElement("input",{type:"range",value:maxFlowMagnitude,min:2e3,max:2e4,onChange:function(evt){return setMaxFlowMagnitude(+evt.currentTarget.value)}}),react_3.default.createElement("label",null,"locationTotalExtent[1]:"),react_3.default.createElement("input",{type:"range",value:maxLocationTotal,min:1e4,max:1e6,step:100,onChange:function(evt){return setMaxLocationTotal(+evt.currentTarget.value)}})),react_3.default.createElement("div",{style:{fontSize:"small",color:"#999"}},"Use it to fix the scales of a changing dataset (e.g. over time)")))}))).add("flowMagnitudeExtent, locationTotalsExtent in diff mode",pipe_1.default(withStats_1.default,withFetch_1.withFetchJson("locations","./data/locations.json"),withFetch_1.withFetchJson("flows","./data/flows-diff-2015-2016.json"))((function(_a){var locations=_a.locations,flows=_a.flows,_b=react_3.default.useState(500),maxFlowMagnitude=_b[0],setMaxFlowMagnitude=_b[1],flowMagnitudeExtent=[0,maxFlowMagnitude],_c=react_3.default.useState(5e4),maxLocationTotal=_c[0],setMaxLocationTotal=_c[1],locationTotalsExtent=[0,maxLocationTotal];return react_3.default.createElement(react_3.default.Fragment,null,react_3.default.createElement(react_1.default,{pickable:!0,diffMode:!0,getLocationId:getLocationId,showTotals:!0,showLocationAreas:!0,flows:flows,flowMagnitudeExtent:flowMagnitudeExtent,locationTotalsExtent:locationTotalsExtent,locations:locations,initialViewState:react_1.getViewStateForFeatures(locations,[window.innerWidth,window.innerHeight]),mapboxAccessToken:index_1.mapboxAccessToken}),react_3.default.createElement(react_1.LegendBox,{bottom:35,left:10},react_3.default.createElement(react_1.DiffColorsLegend,null),react_3.default.createElement("hr",null),react_3.default.createElement(react_1.LocationTotalsLegend,{diff:!0})),react_3.default.createElement(react_1.LegendBox,{top:10,right:10},react_3.default.createElement("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr"}},react_3.default.createElement("label",null,"flowMagnitudeExtent[1]:"),react_3.default.createElement("input",{type:"range",value:maxFlowMagnitude,min:2e3,max:2e4,onChange:function(evt){return setMaxFlowMagnitude(+evt.currentTarget.value)}}),react_3.default.createElement("label",null,"locationTotalExtent[1]:"),react_3.default.createElement("input",{type:"range",value:maxLocationTotal,min:1e3,max:1e5,step:10,onChange:function(evt){return setMaxLocationTotal(+evt.currentTarget.value)}})),react_3.default.createElement("div",{style:{fontSize:"small",color:"#999"}},"Use it to fix the scales of a changing dataset (e.g. over time)")))}))).add("maxFlowThickness animated",pipe_1.default(withStats_1.default,withFetch_1.withFetchJson("locations","./data/locations.json"),withFetch_1.withFetchJson("flows","./data/flows-2016.json"))((function(_a){var locations=_a.locations,flows=_a.flows,_b=react_3.default.useState(15),thickness=_b[0],setThickness=_b[1];return react_3.default.createElement(react_3.default.Fragment,null,react_3.default.createElement(react_1.default,{pickable:!0,getLocationId:getLocationId,maxFlowThickness:thickness,flows:flows,animate:!0,locations:locations,initialViewState:react_1.getViewStateForFeatures(locations,[window.innerWidth,window.innerHeight]),mapboxAccessToken:index_1.mapboxAccessToken}),react_3.default.createElement(react_1.LegendBox,{bottom:35,left:10},react_3.default.createElement(react_1.LocationTotalsLegend,null)),react_3.default.createElement(react_1.LegendBox,{top:10,right:10},react_3.default.createElement("label",null,"Thickness:"),react_3.default.createElement("input",{type:"range",value:thickness,min:0,max:30,onChange:function(evt){return setThickness(+evt.currentTarget.value)}})))}))).add("minPickableFlowThickness",pipe_1.default(withStats_1.default,withFetch_1.withFetchJson("locations","./data/locations.json"),withFetch_1.withFetchJson("flows","./data/flows-2016.json"))((function(_a){var locations=_a.locations,flows=_a.flows;return react_3.default.createElement(react_3.default.Fragment,null,react_3.default.createElement(react_1.default,{pickable:!0,getLocationId:getLocationId,minPickableFlowThickness:1,flows:flows,locations:locations,initialViewState:react_1.getViewStateForFeatures(locations,[window.innerWidth,window.innerHeight]),mapboxAccessToken:index_1.mapboxAccessToken}),react_3.default.createElement(react_1.LegendBox,{bottom:35,left:10},react_3.default.createElement(react_1.LocationTotalsLegend,null)))}))).add("minPickableFlowThickness animated",pipe_1.default(withStats_1.default,withFetch_1.withFetchJson("locations","./data/locations.json"),withFetch_1.withFetchJson("flows","./data/flows-2016.json"))((function(_a){var locations=_a.locations,flows=_a.flows;return react_3.default.createElement(react_3.default.Fragment,null,react_3.default.createElement(react_1.default,{pickable:!0,getLocationId:getLocationId,minPickableFlowThickness:1,animate:!0,flows:flows,locations:locations,initialViewState:react_1.getViewStateForFeatures(locations,[window.innerWidth,window.innerHeight]),mapboxAccessToken:index_1.mapboxAccessToken}),react_3.default.createElement(react_1.LegendBox,{bottom:35,left:10},react_3.default.createElement(react_1.LocationTotalsLegend,null)))}))),react_2.storiesOf("Cluster on zoom",module).add("basic",pipe_1.default(withStats_1.default,withFetch_1.withFetchJson("locations","./data/locations.json"),withFetch_1.withFetchJson("flows","./data/flows-2016.json"))((function(_a){var locations=_a.locations,flows=_a.flows;return react_3.default.createElement(ClusteringExample_1.default,{locations:locations,flows:flows,getLocationId:function(loc){return loc.properties.abbr},getLocationCentroid:function(loc){return loc.properties.centroid},getFlowOriginId:function(flow){return flow.origin},getFlowDestId:function(flow){return flow.dest},getFlowMagnitude:function(flow){return+flow.count}})}))).add("NL commuters",pipe_1.default(withStats_1.default,withSheetsFetch_1.default("1Oe3zM219uSfJ3sjdRT90SAK2kU3xIvzdcCW6cwTsAuc"))((function(_a){var locations=_a.locations,flows=_a.flows;return react_3.default.createElement(ClusteringExample_1.default,{locations:locations,flows:flows,getLocationId:function(loc){return loc.id},getLocationCentroid:function(loc){return[+loc.lon,+loc.lat]},getFlowOriginId:function(flow){return flow.origin},getFlowDestId:function(flow){return flow.dest},getFlowMagnitude:function(flow){return+flow.count}})}))),react_2.storiesOf("Other datasets",module).add("London bicycle hire",pipe_1.default(withStats_1.default,withSheetsFetch_1.default("1Z6dVVFFrdooHIs8xnJ_O7eM5bhS5KscCi7G_k0jUNDI"))((function(_a){var locations=_a.locations,flows=_a.flows;return react_3.default.createElement(Example_1.default,{flows:flows,locations:locations,getLocationId:function(loc){return loc.id},getLocationCentroid:function(location){return[+location.lon,+location.lat]},getFlowOriginId:function(flow){return flow.origin},getFlowDestId:function(flow){return flow.dest},getFlowMagnitude:function(flow){return+flow.count}})}))).add("NYC citibike",pipe_1.default(withStats_1.default,withSheetsFetch_1.default("1Aum0anWxPx6bHyfcFXWCCTE8u0xtfenIls_kPAJEDIA"))((function(_a){var locations=_a.locations,flows=_a.flows;return react_3.default.createElement(Example_1.default,{flows:flows,locations:locations,getLocationId:function(loc){return loc.id},getLocationCentroid:function(location){return[+location.lon,+location.lat]},getFlowOriginId:function(flow){return flow.origin},getFlowDestId:function(flow){return flow.dest},getFlowMagnitude:function(flow){return+flow.count}})}))).add("Chicago taxis",pipe_1.default(withStats_1.default,withSheetsFetch_1.default("1fhX98NFv5gAkkjB2YFCm50-fplFpmWVAZby3dmm9cgQ"))((function(_a){var locations=_a.locations,flows=_a.flows;return react_3.default.createElement(Example_1.default,{flows:flows,locations:locations,getLocationId:function(loc){return loc.id},getLocationCentroid:function(location){return[+location.lon,+location.lat]},getFlowOriginId:function(flow){return flow.origin},getFlowDestId:function(flow){return flow.dest},getFlowMagnitude:function(flow){return+flow.count}})}))).add("NL commuters",pipe_1.default(withStats_1.default,withSheetsFetch_1.default("1Oe3zM219uSfJ3sjdRT90SAK2kU3xIvzdcCW6cwTsAuc"))((function(_a){var locations=_a.locations,flows=_a.flows;return react_3.default.createElement(Example_1.default,{flows:flows,locations:locations,getLocationId:function(loc){return loc.id},getLocationCentroid:function(location){return[+location.lon,+location.lat]},getFlowOriginId:function(flow){return flow.origin},getFlowDestId:function(flow){return flow.dest},getFlowMagnitude:function(flow){return+flow.count}})})))}).call(this,__webpack_require__(205)(module))},414:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.mapboxAccessToken=void 0,__webpack_require__(408),exports.mapboxAccessToken=Object({NODE_ENV:"production",NODE_PATH:"",STORYBOOK:"true",PUBLIC_URL:"."}).MapboxAccessToken||""},415:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});exports.default=function(){for(var args=[],_i=0;_i<arguments.length;_i++)args[_i]=arguments[_i];return function(d){return args.reduce((function(m,f){return f(m)}),d)}}},416:function(module,exports,__webpack_require__){"use strict";var extendStatics,__extends=this&&this.__extends||(extendStatics=function(d,b){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)Object.prototype.hasOwnProperty.call(b,p)&&(d[p]=b[p])})(d,b)},function(d,b){function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}),__assign=this&&this.__assign||function(){return(__assign=Object.assign||function(t){for(var s,i=1,n=arguments.length;i<n;i++)for(var p in s=arguments[i])Object.prototype.hasOwnProperty.call(s,p)&&(t[p]=s[p]);return t}).apply(this,arguments)},__importDefault=this&&this.__importDefault||function(mod){return mod&&mod.__esModule?mod:{default:mod}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.withFetchJson=exports.withFetchCsv=exports.Message=void 0;var d3_dsv_1=__webpack_require__(830),react_1=__importDefault(__webpack_require__(0)),Message=function(_a){var children=_a.children;return react_1.default.createElement("div",{style:{padding:"1em"}},children)};exports.Message=Message;var withFetch=function(mode,propName,url){return function(Comp){return function(props){var Fetcher=function(_super){function Fetcher(){var _this=null!==_super&&_super.apply(this,arguments)||this;return _this.state={error:null,data:null},_this}return __extends(Fetcher,_super),Fetcher.prototype.componentDidMount=function(){var _this=this;fetch(url).then((function(response){if(!response.ok)throw new Error(response.statusText);switch(mode){case"json":return response.json();case"csv":return response.text()}})).catch((function(reason){console.error(reason),_this.setState({error:!0})})).then((function(data){return _this.setState({data:"csv"===mode?d3_dsv_1.csvParse(data):data})}))},Fetcher.prototype.render=function(){var _a,_b=this.state,data=_b.data;return _b.error?react_1.default.createElement(exports.Message,null,"Oops Data fetching failed."):data?react_1.default.createElement(Comp,__assign({},__assign(__assign({},props),((_a={})[propName]=this.state.data,_a)))):react_1.default.createElement(exports.Message,null,"Fetching data")},Fetcher}(react_1.default.Component);return react_1.default.createElement(Fetcher,null)}}};exports.withFetchCsv=function(propName,url){return withFetch("csv",propName,url)};exports.withFetchJson=function(propName,url){return withFetch("json",propName,url)};try{Message.displayName="Message",Message.__docgenInfo={description:"",displayName:"Message",props:{}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["src/utils/withFetch.tsx#Message"]={docgenInfo:Message.__docgenInfo,name:"Message",path:"src/utils/withFetch.tsx#Message"})}catch(__react_docgen_typescript_loader_error){}},417:function(module,exports,__webpack_require__){"use strict";var extendStatics,__extends=this&&this.__extends||(extendStatics=function(d,b){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)Object.prototype.hasOwnProperty.call(b,p)&&(d[p]=b[p])})(d,b)},function(d,b){function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}),__assign=this&&this.__assign||function(){return(__assign=Object.assign||function(t){for(var s,i=1,n=arguments.length;i<n;i++)for(var p in s=arguments[i])Object.prototype.hasOwnProperty.call(s,p)&&(t[p]=s[p]);return t}).apply(this,arguments)},__createBinding=this&&this.__createBinding||(Object.create?function(o,m,k,k2){void 0===k2&&(k2=k),Object.defineProperty(o,k2,{enumerable:!0,get:function(){return m[k]}})}:function(o,m,k,k2){void 0===k2&&(k2=k),o[k2]=m[k]}),__setModuleDefault=this&&this.__setModuleDefault||(Object.create?function(o,v){Object.defineProperty(o,"default",{enumerable:!0,value:v})}:function(o,v){o.default=v}),__importStar=this&&this.__importStar||function(mod){if(mod&&mod.__esModule)return mod;var result={};if(null!=mod)for(var k in mod)"default"!==k&&Object.prototype.hasOwnProperty.call(mod,k)&&__createBinding(result,mod,k);return __setModuleDefault(result,mod),result},__importDefault=this&&this.__importDefault||function(mod){return mod&&mod.__esModule?mod:{default:mod}};Object.defineProperty(exports,"__esModule",{value:!0});var react_1=__importStar(__webpack_require__(419)),react_2=__importDefault(__webpack_require__(0)),index_1=__webpack_require__(414),tooltipStyle={position:"absolute",pointerEvents:"none",zIndex:1,background:"#125",color:"#fff",fontSize:9,borderRadius:4,padding:5,maxWidth:300,maxHeight:300,overflow:"hidden",boxShadow:"2px 2px 4px #ccc"},Example=function(_super){function Example(props){var _this=_super.call(this,props)||this;_this.state={tooltip:void 0},_this.handleViewStateChange=function(viewState){var onViewStateChange=_this.props.onViewStateChange;onViewStateChange&&onViewStateChange(viewState),_this.state.tooltip&&_this.setState({tooltip:void 0})},_this.handleHighlight=function(highlight,info){info||_this.setState({tooltip:void 0}),_this.setState({tooltip:info})};var locations=props.locations,getLocationCentroid=props.getLocationCentroid;return _this.initialViewState=react_1.getViewStateForLocations(locations,getLocationCentroid,[window.innerWidth,window.innerHeight]),_this}return __extends(Example,_super),Example.prototype.renderTooltip=function(){var tooltip=this.state.tooltip;if(!tooltip)return null;var object=tooltip.object,x=tooltip.x,y=tooltip.y;return object?react_2.default.createElement("pre",{style:__assign(__assign({},tooltipStyle),{left:x,top:y})},JSON.stringify(object,null,2)):null},Example.prototype.render=function(){var _a=this.props,flows=_a.flows,locations=_a.locations,getLocationId=_a.getLocationId,getLocationCentroid=_a.getLocationCentroid,getFlowMagnitude=_a.getFlowMagnitude;return react_2.default.createElement(react_2.default.Fragment,null,react_2.default.createElement(react_1.default,{pickable:!0,initialViewState:this.initialViewState,showTotals:!0,showLocationAreas:!1,showOnlyTopFlows:1e4,flows:flows,locations:locations,mapboxAccessToken:index_1.mapboxAccessToken,getLocationId:getLocationId,getLocationCentroid:getLocationCentroid,getFlowMagnitude:getFlowMagnitude,onViewStateChange:this.handleViewStateChange,onHighlighted:this.handleHighlight}),react_2.default.createElement(react_1.LegendBox,{bottom:35,left:10},react_2.default.createElement(react_1.LocationTotalsLegend,null)),react_2.default.createElement(react_1.LegendBox,{bottom:35,right:10},"Showing "+(flows.length>1e4?"top 10000 of":"")+" "+flows.length+" flows. "),this.renderTooltip())},Example}(react_2.default.Component);exports.default=Example;try{Example.displayName="Example",Example.__docgenInfo={description:"",displayName:"Example",props:{locations:{defaultValue:null,description:"",name:"locations",required:!0,type:{name:"any[]"}},flows:{defaultValue:null,description:"",name:"flows",required:!0,type:{name:"any[]"}},onViewStateChange:{defaultValue:null,description:"",name:"onViewStateChange",required:!1,type:{name:"((viewState: ViewState) => void)"}},getFlowOriginId:{defaultValue:null,description:"",name:"getFlowOriginId",required:!0,type:{name:"FlowAccessor<string>"}},getFlowDestId:{defaultValue:null,description:"",name:"getFlowDestId",required:!0,type:{name:"FlowAccessor<string>"}},getFlowMagnitude:{defaultValue:null,description:"",name:"getFlowMagnitude",required:!0,type:{name:"FlowAccessor<number>"}},getFlowColor:{defaultValue:null,description:"",name:"getFlowColor",required:!1,type:{name:"FlowAccessor<string> | undefined"}},getAnimatedFlowLineStaggering:{defaultValue:null,description:"",name:"getAnimatedFlowLineStaggering",required:!1,type:{name:"FlowAccessor<string> | undefined"}},getLocationId:{defaultValue:null,description:"",name:"getLocationId",required:!0,type:{name:"LocationAccessor<string>"}},getLocationCentroid:{defaultValue:null,description:"",name:"getLocationCentroid",required:!0,type:{name:"LocationAccessor<[number, number]>"}},getLocationTotalIn:{defaultValue:null,description:"",name:"getLocationTotalIn",required:!1,type:{name:"LocationAccessor<number>"}},getLocationTotalOut:{defaultValue:null,description:"",name:"getLocationTotalOut",required:!1,type:{name:"LocationAccessor<number>"}},getLocationTotalWithin:{defaultValue:null,description:"",name:"getLocationTotalWithin",required:!1,type:{name:"LocationAccessor<number>"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["src/components/Example.tsx#Example"]={docgenInfo:Example.__docgenInfo,name:"Example",path:"src/components/Example.tsx#Example"})}catch(__react_docgen_typescript_loader_error){}},419:function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,"LocationTotalsLegend",(function(){return legend_LocationTotalsLegend})),__webpack_require__.d(__webpack_exports__,"DiffColorsLegend",(function(){return legend_DiffColorsLegend})),__webpack_require__.d(__webpack_exports__,"LegendBox",(function(){return legend_LegendBox})),__webpack_require__.d(__webpack_exports__,"getViewStateForFeatures",(function(){return getViewStateForFeatures})),__webpack_require__.d(__webpack_exports__,"getViewStateForLocations",(function(){return getViewStateForLocations}));var dist_esm=__webpack_require__(26),react=__webpack_require__(0),react_default=__webpack_require__.n(react);var legend_Disc=({size:size,inner:inner,outer:outer,outline:outline})=>react.createElement("svg",{width:size,height:size,style:{marginRight:5}},react.createElement("circle",{cx:size/2,cy:size/2,r:.5*size,fill:Object(dist_esm.rgbaAsString)(outline)}),react.createElement("circle",{cx:size/2,cy:size/2,r:.5*size-1,fill:Object(dist_esm.rgbaAsString)(outer)}),react.createElement("circle",{cx:size/2,cy:size/2,r:.5*size*.6-1,fill:Object(dist_esm.rgbaAsString)(inner)}));const styles={outer:{display:"flex",flexDirection:"column"},item:{outer:{display:"flex",flexDirection:"row",padding:"3px 0",alignItems:"center"},caption:{marginLeft:2}}};var legend_LocationTotalsLegend=({diff:diff,colors:colors,aboutEqualText:aboutEqualText,moreOutgoingText:moreOutgoingText,moreIncomingText:moreIncomingText})=>{const colorsRGBA=diff?Object(dist_esm.getDiffColorsRGBA)(colors):Object(dist_esm.getColorsRGBA)(colors),pos=Object(dist_esm.isDiffColorsRGBA)(colorsRGBA)?colorsRGBA.positive.locationCircles:colorsRGBA.locationCircles,neg=Object(dist_esm.isDiffColorsRGBA)(colorsRGBA)?colorsRGBA.negative.locationCircles:void 0;return react.createElement("div",{style:styles.outer},react.createElement("div",null,react.createElement("div",{style:styles.item.outer},react.createElement(legend_Disc,{size:20,inner:pos.inner,outer:pos.inner,outline:pos.inner}),neg&&react.createElement(legend_Disc,{size:20,inner:neg.inner,outer:neg.inner,outline:neg.inner}),react.createElement("div",{style:styles.item.caption},aboutEqualText||"outgoing  incoming")),react.createElement("div",{style:styles.item.outer},react.createElement(legend_Disc,{size:20,inner:pos.inner,outer:pos.outgoing,outline:pos.inner}),neg&&react.createElement(legend_Disc,{size:20,inner:neg.inner,outer:neg.outgoing,outline:neg.inner}),react.createElement("div",{style:styles.item.caption},moreOutgoingText||"more outgoing")),react.createElement("div",{style:styles.item.outer},react.createElement(legend_Disc,{size:20,inner:pos.inner,outer:pos.incoming,outline:pos.incoming}),neg&&react.createElement(legend_Disc,{size:20,inner:neg.inner,outer:neg.incoming,outline:neg.incoming}),react.createElement("div",{style:styles.item.caption},moreIncomingText||"more incoming"))))};const DiffColorsLegend_styles={outer:{display:"flex",flexDirection:"column"},disc:{marginRight:5},item:{outer:{display:"flex",flexDirection:"row",padding:"3px 0",alignItems:"center"},caption:{marginLeft:2}}};var legend_DiffColorsLegend=props=>{const colorsRGBA=Object(dist_esm.getDiffColorsRGBA)(props.colors),pos=colorsRGBA.positive.locationCircles,neg=colorsRGBA.negative.locationCircles;return react.createElement("div",{style:DiffColorsLegend_styles.outer},react.createElement("div",{style:DiffColorsLegend_styles.item.outer},react.createElement(legend_Disc,{size:20,inner:pos.inner,outer:pos.inner,outline:pos.inner}),react.createElement("div",{style:DiffColorsLegend_styles.item.caption},props.positiveText||"positive difference")),react.createElement("div",{style:DiffColorsLegend_styles.item.outer},react.createElement(legend_Disc,{size:20,inner:neg.inner,outer:neg.inner,outline:neg.inner}),react.createElement("div",{style:DiffColorsLegend_styles.item.caption},props.negativeText||"negative difference")))};const LegendBox_styles_outer={position:"absolute",background:"#fff",padding:10,borderRadius:4,border:"1px solid #ccc"};var legend_LegendBox=({style:style,top:top,left:left,right:right,bottom:bottom,children:children})=>react_default.a.createElement("div",{style:Object.assign(Object.assign(Object.assign({},LegendBox_styles_outer),style),{top:top,left:left,right:right,bottom:bottom})},children),geo_viewport=__webpack_require__(429),src_bounds=__webpack_require__(852);function getViewStateForFeatures(featureCollection,size,opts){const{pad:pad=.05,tileSize:tileSize=512,minZoom:minZoom=0,maxZoom:maxZoom=100}=opts||{},[[x1,y1],[x2,y2]]=Object(src_bounds.a)(featureCollection),bounds=[x1-pad*(x2-x1),y1-pad*(y2-y1),x2+pad*(x2-x1),y2+pad*(y2-y1)],{center:[longitude,latitude],zoom:zoom}=Object(geo_viewport.viewport)(bounds,size,void 0,void 0,tileSize,!0);return{longitude:longitude,latitude:latitude,zoom:Math.max(Math.min(maxZoom,zoom),minZoom),bearing:0,pitch:0}}function getViewStateForLocations(locations,getLocationCentroid,size,opts){return getViewStateForFeatures({type:"GeometryCollection",geometries:locations.map(location=>({type:"Point",coordinates:getLocationCentroid(location)}))},size,opts)}var deckgl=__webpack_require__(224),esm=__webpack_require__(303),__rest=function(s,e){var t={};for(var p in s)Object.prototype.hasOwnProperty.call(s,p)&&e.indexOf(p)<0&&(t[p]=s[p]);if(null!=s&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(p=Object.getOwnPropertySymbols(s);i<p.length;i++)e.indexOf(p[i])<0&&Object.prototype.propertyIsEnumerable.call(s,p[i])&&(t[p[i]]=s[p[i]])}return t};class FlowMap_FlowMap extends react.Component{constructor(){super(...arguments),this.state={viewState:this.props.initialViewState,time:0},this.animationFrame=-1,this.animate=()=>{const timestamp=Date.now()/1e3;this.setState({time:timestamp%60/60*1800}),this.animationFrame=window.requestAnimationFrame(this.animate)},this.handleFlowMapHover=info=>{const{type:type,object:object}=info;switch(type){case dist_esm.PickingType.FLOW:object?this.highlight({type:"flow",flow:object},info):this.highlight(void 0);break;case dist_esm.PickingType.LOCATION_AREA:case dist_esm.PickingType.LOCATION:{const{getLocationId:getLocationId}=this.props;object?this.highlight({type:type===dist_esm.PickingType.LOCATION_AREA?"locationArea":"location",locationId:(getLocationId||dist_esm.default.defaultProps.getLocationId.value)(object)},info):this.highlight(void 0);break}}},this.handleFlowMapClick=({type:type,object:object})=>{switch(type){case dist_esm.PickingType.LOCATION_AREA:case dist_esm.PickingType.LOCATION:if(object){const{getLocationId:getLocationId,multiselect:multiselect}=this.props,{selectedLocationIds:selectedLocationIds}=this.state,locationId=(getLocationId||dist_esm.default.defaultProps.getLocationId.value)(object),isSelected=selectedLocationIds&&selectedLocationIds.indexOf(locationId)>=0;let next;next=multiselect?selectedLocationIds?isSelected?selectedLocationIds.filter(id=>id!==locationId):[...selectedLocationIds,locationId]:[locationId]:isSelected?void 0:[locationId],this.selectLocations(next),this.highlight(void 0)}}},this.handleViewStateChange=({viewState:viewState})=>{this.setState({viewState:viewState,highlight:void 0});const{onViewStateChange:onViewStateChange}=this.props;onViewStateChange&&onViewStateChange(viewState)},this.handleKeyDown=evt=>{evt instanceof KeyboardEvent&&"Escape"===evt.key&&this.setState({selectedLocationIds:void 0,highlight:void 0})}}static getDerivedStateFromProps(props,state){return props.selectedLocationIds!==state.selectedLocationIds?{selectedLocationIds:props.selectedLocationIds}:null}componentDidMount(){document.addEventListener("keydown",this.handleKeyDown);const{animate:animate}=this.props;animate&&this.animate();const{onViewStateChange:onViewStateChange}=this.props;if(onViewStateChange){const{viewState:viewState}=this.state;viewState&&onViewStateChange(viewState)}}componentDidUpdate(prevProps,prevState,snapshot){const{animate:animate}=this.props;animate!==prevProps.animate&&(animate?this.animate():this.stopAnimation())}componentWillUnmount(){document.removeEventListener("keydown",this.handleKeyDown),this.stopAnimation()}render(){const{mapboxAccessToken:mapboxAccessToken,mapStyle:mapStyle,mixBlendMode:mixBlendMode}=this.props,flowMapLayer=this.getFlowMapLayer();return react.createElement(react.Fragment,null,react.createElement(deckgl.a,{style:{mixBlendMode:mixBlendMode},layers:[flowMapLayer],viewState:this.state.viewState,controller:!0,onViewStateChange:this.handleViewStateChange},react.createElement(esm.StaticMap,{width:"100%",height:"100%",mapboxApiAccessToken:mapboxAccessToken,mapStyle:mapStyle})))}stopAnimation(){this.animationFrame&&window.cancelAnimationFrame(this.animationFrame)}getFlowMapLayer(){const _a=this.props,{initialViewState:initialViewState,mapboxAccessToken:mapboxAccessToken,mixBlendMode:mixBlendMode,multiselect:multiselect,animationTailLength:animationTailLength,onSelected:onSelected,onHighlighted:onHighlighted}=_a,flowMapLayerProps=__rest(_a,["initialViewState","mapboxAccessToken","mixBlendMode","multiselect","animationTailLength","onSelected","onHighlighted"]),{highlight:highlight,selectedLocationIds:selectedLocationIds}=this.state;return new dist_esm.default(Object.assign(Object.assign({id:"flow-map-layer",animationCurrentTime:this.state.time},flowMapLayerProps),{selectedLocationIds:selectedLocationIds,animationTailLength:animationTailLength,highlightedLocationId:highlight&&"location"===highlight.type?highlight.locationId:void 0,highlightedLocationAreaId:highlight&&"locationArea"===highlight.type?highlight.locationId:void 0,highlightedFlow:highlight&&"flow"===highlight.type?highlight.flow:void 0,onHover:this.handleFlowMapHover,onClick:this.handleFlowMapClick}))}highlight(highlight,info){this.setState({highlight:highlight});const{onHighlighted:onHighlighted}=this.props;onHighlighted&&onHighlighted(highlight,info)}selectLocations(selectedLocationIds){this.setState(state=>Object.assign(Object.assign({},state),{selectedLocationIds:selectedLocationIds}));const{onSelected:onSelected}=this.props;onSelected&&onSelected(selectedLocationIds)}}FlowMap_FlowMap.defaultProps={mixBlendMode:"multiply"};__webpack_exports__.default=FlowMap_FlowMap},446:function(module,exports,__webpack_require__){__webpack_require__(447),__webpack_require__(619),__webpack_require__(620),module.exports=__webpack_require__(811)},521:function(module,exports){},620:function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__);__webpack_require__(225)},811:function(module,exports,__webpack_require__){"use strict";var _clientApi=__webpack_require__(206),_clientLogger=__webpack_require__(104),_configFilename=__webpack_require__(812);function ownKeys(object,enumerableOnly){var keys=Object.keys(object);if(Object.getOwnPropertySymbols){var symbols=Object.getOwnPropertySymbols(object);enumerableOnly&&(symbols=symbols.filter((function(sym){return Object.getOwnPropertyDescriptor(object,sym).enumerable}))),keys.push.apply(keys,symbols)}return keys}function _objectSpread(target){for(var i=1;i<arguments.length;i++){var source=null!=arguments[i]?arguments[i]:{};i%2?ownKeys(Object(source),!0).forEach((function(key){_defineProperty(target,key,source[key])})):Object.getOwnPropertyDescriptors?Object.defineProperties(target,Object.getOwnPropertyDescriptors(source)):ownKeys(Object(source)).forEach((function(key){Object.defineProperty(target,key,Object.getOwnPropertyDescriptor(source,key))}))}return target}function _defineProperty(obj,key,value){return key in obj?Object.defineProperty(obj,key,{value:value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value,obj}(_configFilename.args||_configFilename.argTypes)&&_clientLogger.logger.warn("Invalid args/argTypes in config, ignoring.",JSON.stringify({args:_configFilename.args,argTypes:_configFilename.argTypes})),_configFilename.decorators&&_configFilename.decorators.forEach((function(decorator){return(0,_clientApi.addDecorator)(decorator,!1)})),_configFilename.loaders&&_configFilename.loaders.forEach((function(loader){return(0,_clientApi.addLoader)(loader,!1)})),(_configFilename.parameters||_configFilename.globals||_configFilename.globalTypes)&&(0,_clientApi.addParameters)(_objectSpread(_objectSpread({},_configFilename.parameters),{},{globals:_configFilename.globals,globalTypes:_configFilename.globalTypes}),!1),_configFilename.argTypesEnhancers&&_configFilename.argTypesEnhancers.forEach((function(enhancer){return(0,_clientApi.addArgTypesEnhancer)(enhancer)}))},812:function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__),function(module){__webpack_require__(814);var _storybook_react__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(225);const req=__webpack_require__(818);Object(_storybook_react__WEBPACK_IMPORTED_MODULE_1__.configure)((function loadStories(){req.keys().forEach(req)}),module)}.call(this,__webpack_require__(813)(module))},814:function(module,exports,__webpack_require__){var api=__webpack_require__(815),content=__webpack_require__(816);"string"==typeof(content=content.__esModule?content.default:content)&&(content=[[module.i,content,""]]);var options={insert:"head",singleton:!1};api(content,options);module.exports=content.locals||{}},816:function(module,exports,__webpack_require__){(exports=__webpack_require__(817)(!1)).push([module.i,'/*\n * Copyright 2019 Teralytics\n *\n * Licensed under the Apache License, Version 2.0 (the "License");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an "AS IS" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n *\n */\n\nbody {\n  font-family: sans-serif;\n}\n\n#deckgl-overlay {\n  /* This is temporary until mixBlendMode style prop works in <DeckGL> as before v8 */\n  mix-blend-mode: inherit;\n}\n',""]),module.exports=exports},818:function(module,exports,__webpack_require__){var map={"./index.tsx":408};function webpackContext(req){var id=webpackContextResolve(req);return __webpack_require__(id)}function webpackContextResolve(req){if(!__webpack_require__.o(map,req)){var e=new Error("Cannot find module '"+req+"'");throw e.code="MODULE_NOT_FOUND",e}return map[req]}webpackContext.keys=function webpackContextKeys(){return Object.keys(map)},webpackContext.resolve=webpackContextResolve,module.exports=webpackContext,webpackContext.id=818},819:function(module,exports){},825:function(module,exports,__webpack_require__){"use strict";var extendStatics,__extends=this&&this.__extends||(extendStatics=function(d,b){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)Object.prototype.hasOwnProperty.call(b,p)&&(d[p]=b[p])})(d,b)},function(d,b){function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}),__assign=this&&this.__assign||function(){return(__assign=Object.assign||function(t){for(var s,i=1,n=arguments.length;i<n;i++)for(var p in s=arguments[i])Object.prototype.hasOwnProperty.call(s,p)&&(t[p]=s[p]);return t}).apply(this,arguments)},__createBinding=this&&this.__createBinding||(Object.create?function(o,m,k,k2){void 0===k2&&(k2=k),Object.defineProperty(o,k2,{enumerable:!0,get:function(){return m[k]}})}:function(o,m,k,k2){void 0===k2&&(k2=k),o[k2]=m[k]}),__setModuleDefault=this&&this.__setModuleDefault||(Object.create?function(o,v){Object.defineProperty(o,"default",{enumerable:!0,value:v})}:function(o,v){o.default=v}),__importStar=this&&this.__importStar||function(mod){if(mod&&mod.__esModule)return mod;var result={};if(null!=mod)for(var k in mod)"default"!==k&&Object.prototype.hasOwnProperty.call(mod,k)&&__createBinding(result,mod,k);return __setModuleDefault(result,mod),result},__importDefault=this&&this.__importDefault||function(mod){return mod&&mod.__esModule?mod:{default:mod}};Object.defineProperty(exports,"__esModule",{value:!0});var React=__importStar(__webpack_require__(0)),stats_js_1=__importDefault(__webpack_require__(826));function withStats(Comp){return function(props){var WithStats=function(_super){function WithStats(){var _this=null!==_super&&_super.apply(this,arguments)||this;return _this.stats=new stats_js_1.default,_this.statsContainer=React.createRef(),_this.animateRef=0,_this}return __extends(WithStats,_super),WithStats.prototype.componentDidMount=function(){var _this=this;this.statsContainer.current&&(this.stats.showPanel(0),this.statsContainer.current.appendChild(this.stats.dom));var calcFPS=function(){_this.stats.begin(),_this.stats.end(),_this.animateRef=window.requestAnimationFrame(calcFPS)};this.animateRef=window.requestAnimationFrame(calcFPS)},WithStats.prototype.componentWillUnmount=function(){window.cancelAnimationFrame(this.animateRef)},WithStats.prototype.render=function(){return React.createElement(React.Fragment,null,React.createElement(Comp,__assign({},props)),React.createElement("div",{ref:this.statsContainer}))},WithStats}(React.Component);return React.createElement(WithStats,null)}}exports.default=withStats;try{withStats.displayName="withStats",withStats.__docgenInfo={description:"",displayName:"withStats",props:{}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["src/utils/withStats.tsx#withStats"]={docgenInfo:withStats.__docgenInfo,name:"withStats",path:"src/utils/withStats.tsx#withStats"})}catch(__react_docgen_typescript_loader_error){}},827:function(module,exports,__webpack_require__){"use strict";var extendStatics,__extends=this&&this.__extends||(extendStatics=function(d,b){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)Object.prototype.hasOwnProperty.call(b,p)&&(d[p]=b[p])})(d,b)},function(d,b){function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}),__createBinding=this&&this.__createBinding||(Object.create?function(o,m,k,k2){void 0===k2&&(k2=k),Object.defineProperty(o,k2,{enumerable:!0,get:function(){return m[k]}})}:function(o,m,k,k2){void 0===k2&&(k2=k),o[k2]=m[k]}),__setModuleDefault=this&&this.__setModuleDefault||(Object.create?function(o,v){Object.defineProperty(o,"default",{enumerable:!0,value:v})}:function(o,v){o.default=v}),__importStar=this&&this.__importStar||function(mod){if(mod&&mod.__esModule)return mod;var result={};if(null!=mod)for(var k in mod)"default"!==k&&Object.prototype.hasOwnProperty.call(mod,k)&&__createBinding(result,mod,k);return __setModuleDefault(result,mod),result},__importDefault=this&&this.__importDefault||function(mod){return mod&&mod.__esModule?mod:{default:mod}};Object.defineProperty(exports,"__esModule",{value:!0});var Cluster=__importStar(__webpack_require__(831)),core_1=__webpack_require__(26),react_1=__importDefault(__webpack_require__(0)),Example_1=__importDefault(__webpack_require__(417)),ClusteringExample=function(_super){function ClusteringExample(props){var _this=_super.call(this,props)||this;_this.handleViewStateChange=function(viewState){var availableZoomLevels=_this.clusterIndex.availableZoomLevels,zoom=viewState.zoom,clusterZoom=Cluster.findAppropriateZoomLevel(availableZoomLevels,zoom);_this.setState({clusteredLocations:_this.clusterIndex.getClusterNodesFor(clusterZoom),aggregateFlows:_this.aggregateFlowsByZoom.get(clusterZoom)})};var clusterLevels,_a=_this.props,flows=_a.flows,getLocationId=_a.getLocationId,getLocationCentroid=_a.getLocationCentroid,getFlowOriginId=_a.getFlowOriginId,getFlowDestId=_a.getFlowDestId,getFlowMagnitude=_a.getFlowMagnitude,locations=core_1.isFeatureCollection(_this.props.locations)?_this.props.locations.features:_this.props.locations;if(_this.props.clusterLevels)clusterLevels=_this.props.clusterLevels;else{var getLocationWeight=Cluster.makeLocationWeightGetter(flows,{getFlowOriginId:getFlowOriginId,getFlowDestId:getFlowDestId,getFlowMagnitude:getFlowMagnitude});clusterLevels=Cluster.clusterLocations(locations,{getLocationId:getLocationId,getLocationCentroid:getLocationCentroid},getLocationWeight,{makeClusterName:function(id,numPoints){return"Cluster #"+id+" of "+numPoints+" locations"}})}for(var clusterIndex=Cluster.buildIndex(clusterLevels),aggregateFlowsByZoom=new Map,_i=0,_b=clusterIndex.availableZoomLevels;_i<_b.length;_i++){var zoom=_b[_i];aggregateFlowsByZoom.set(zoom,clusterIndex.aggregateFlows(flows,zoom,{getFlowOriginId:getFlowOriginId,getFlowDestId:getFlowDestId,getFlowMagnitude:getFlowMagnitude}))}var maxZoom=Math.max.apply(null,clusterIndex.availableZoomLevels);return _this.clusterIndex=clusterIndex,_this.aggregateFlowsByZoom=aggregateFlowsByZoom,_this.state={clusteredLocations:_this.clusterIndex.getClusterNodesFor(maxZoom),aggregateFlows:_this.aggregateFlowsByZoom.get(maxZoom)},_this}return __extends(ClusteringExample,_super),ClusteringExample.prototype.render=function(){var _a=this.props,getFlowOriginId=_a.getFlowOriginId,getFlowDestId=_a.getFlowDestId,getFlowMagnitude=_a.getFlowMagnitude,_b=this.state,clusteredLocations=_b.clusteredLocations,aggregateFlows=_b.aggregateFlows;return clusteredLocations&&aggregateFlows?react_1.default.createElement(Example_1.default,{locations:clusteredLocations,flows:aggregateFlows,getLocationId:function(loc){return loc.id},getLocationCentroid:function(loc){return loc.centroid},getFlowOriginId:function(flow){return Cluster.isAggregateFlow(flow)?flow.origin:getFlowOriginId(flow)},getFlowDestId:function(flow){return Cluster.isAggregateFlow(flow)?flow.dest:getFlowDestId(flow)},getFlowMagnitude:function(flow){return Cluster.isAggregateFlow(flow)?flow.count:getFlowMagnitude(flow)},onViewStateChange:this.handleViewStateChange}):null},ClusteringExample}(react_1.default.Component);exports.default=ClusteringExample;try{ClusteringExample.displayName="ClusteringExample",ClusteringExample.__docgenInfo={description:"",displayName:"ClusteringExample",props:{flows:{defaultValue:null,description:"",name:"flows",required:!0,type:{name:"any[]"}},locations:{defaultValue:null,description:"",name:"locations",required:!0,type:{name:"any[]"}},clusterLevels:{defaultValue:null,description:"",name:"clusterLevels",required:!1,type:{name:"ClusterLevel[]"}},getFlowOriginId:{defaultValue:null,description:"",name:"getFlowOriginId",required:!0,type:{name:"FlowAccessor<string>"}},getFlowDestId:{defaultValue:null,description:"",name:"getFlowDestId",required:!0,type:{name:"FlowAccessor<string>"}},getFlowMagnitude:{defaultValue:null,description:"",name:"getFlowMagnitude",required:!0,type:{name:"FlowAccessor<number>"}},getFlowColor:{defaultValue:null,description:"",name:"getFlowColor",required:!1,type:{name:"FlowAccessor<string> | undefined"}},getAnimatedFlowLineStaggering:{defaultValue:null,description:"",name:"getAnimatedFlowLineStaggering",required:!1,type:{name:"FlowAccessor<string> | undefined"}},getLocationId:{defaultValue:null,description:"",name:"getLocationId",required:!0,type:{name:"LocationAccessor<string>"}},getLocationCentroid:{defaultValue:null,description:"",name:"getLocationCentroid",required:!0,type:{name:"LocationAccessor<[number, number]>"}},getLocationTotalIn:{defaultValue:null,description:"",name:"getLocationTotalIn",required:!1,type:{name:"LocationAccessor<number>"}},getLocationTotalOut:{defaultValue:null,description:"",name:"getLocationTotalOut",required:!1,type:{name:"LocationAccessor<number>"}},getLocationTotalWithin:{defaultValue:null,description:"",name:"getLocationTotalWithin",required:!1,type:{name:"LocationAccessor<number>"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["src/components/ClusteringExample.tsx#ClusteringExample"]={docgenInfo:ClusteringExample.__docgenInfo,name:"ClusteringExample",path:"src/components/ClusteringExample.tsx#ClusteringExample"})}catch(__react_docgen_typescript_loader_error){}},828:function(module,exports,__webpack_require__){"use strict";var __assign=this&&this.__assign||function(){return(__assign=Object.assign||function(t){for(var s,i=1,n=arguments.length;i<n;i++)for(var p in s=arguments[i])Object.prototype.hasOwnProperty.call(s,p)&&(t[p]=s[p]);return t}).apply(this,arguments)},__createBinding=this&&this.__createBinding||(Object.create?function(o,m,k,k2){void 0===k2&&(k2=k),Object.defineProperty(o,k2,{enumerable:!0,get:function(){return m[k]}})}:function(o,m,k,k2){void 0===k2&&(k2=k),o[k2]=m[k]}),__setModuleDefault=this&&this.__setModuleDefault||(Object.create?function(o,v){Object.defineProperty(o,"default",{enumerable:!0,value:v})}:function(o,v){o.default=v}),__importStar=this&&this.__importStar||function(mod){if(mod&&mod.__esModule)return mod;var result={};if(null!=mod)for(var k in mod)"default"!==k&&Object.prototype.hasOwnProperty.call(mod,k)&&__createBinding(result,mod,k);return __setModuleDefault(result,mod),result},__importDefault=this&&this.__importDefault||function(mod){return mod&&mod.__esModule?mod:{default:mod}};Object.defineProperty(exports,"__esModule",{value:!0});var React=__importStar(__webpack_require__(0)),pipe_1=__importDefault(__webpack_require__(415)),withFetch_1=__webpack_require__(416),withSheetsFetch=function(sheetKey){return function(Comp){return function(props){var Fetcher=pipe_1.default(withFetch_1.withFetchCsv("locations","https://docs.google.com/spreadsheets/d/"+sheetKey+"/gviz/tq?tqx=out:csv&sheet=locations"),withFetch_1.withFetchCsv("flows","https://docs.google.com/spreadsheets/d/"+sheetKey+"/gviz/tq?tqx=out:csv&sheet=flows"))((function(_a){var locations=_a.locations,flows=_a.flows;return React.createElement(Comp,__assign({locations:locations,flows:flows,sheetKey:sheetKey},props))}));return React.createElement(Fetcher,null)}}};exports.default=withSheetsFetch;try{withSheetsFetch.displayName="withSheetsFetch",withSheetsFetch.__docgenInfo={description:"",displayName:"withSheetsFetch",props:{}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["src/utils/withSheetsFetch.tsx#withSheetsFetch"]={docgenInfo:withSheetsFetch.__docgenInfo,name:"withSheetsFetch",path:"src/utils/withSheetsFetch.tsx#withSheetsFetch"})}catch(__react_docgen_typescript_loader_error){}},831:function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,"buildIndex",(function(){return buildIndex})),__webpack_require__.d(__webpack_exports__,"makeLocationWeightGetter",(function(){return makeLocationWeightGetter})),__webpack_require__.d(__webpack_exports__,"findAppropriateZoomLevel",(function(){return findAppropriateZoomLevel})),__webpack_require__.d(__webpack_exports__,"isCluster",(function(){return isCluster})),__webpack_require__.d(__webpack_exports__,"isAggregateFlow",(function(){return isAggregateFlow})),__webpack_require__.d(__webpack_exports__,"clusterLocations",(function(){return clusterLocations}));var extent=__webpack_require__(845),ascending=__webpack_require__(231),bisect=__webpack_require__(857);function isCluster(c){const{children:children}=c;return children&&children.length>0}function isAggregateFlow(flow){const{origin:origin,dest:dest,count:count,aggregate:aggregate}=flow;return void 0!==origin&&void 0!==dest&&void 0!==count&&!!aggregate}function buildIndex(clusterLevels){const nodesByZoom=new Map,clustersById=new Map,minZoomByLocationId=new Map;for(const{zoom:zoom,nodes:nodes}of clusterLevels){nodesByZoom.set(zoom,nodes);for(const node of nodes)if(isCluster(node))clustersById.set(node.id,node);else{const{id:id}=node,mz=minZoomByLocationId.get(id);(null==mz||mz>zoom)&&minZoomByLocationId.set(id,zoom)}}const[minZoom,maxZoom]=Object(extent.a)(clusterLevels,cl=>cl.zoom);if(null==minZoom||null==maxZoom)throw new Error("Could not determine minZoom or maxZoom");const leavesToClustersByZoom=new Map;for(const cluster of clustersById.values()){const{zoom:zoom}=cluster;let leavesToClusters=leavesToClustersByZoom.get(zoom);leavesToClusters||(leavesToClusters=new Map,leavesToClustersByZoom.set(zoom,leavesToClusters)),visitClusterLeaves(cluster,leafId=>{leavesToClusters.set(leafId,cluster)})}function visitClusterLeaves(cluster,visit){for(const childId of cluster.children){const child=clustersById.get(childId);child?visitClusterLeaves(child,visit):visit(childId)}}function findClusterFor(locationId,zoom){const leavesToClusters=leavesToClustersByZoom.get(zoom);if(!leavesToClusters)return;const cluster=leavesToClusters.get(locationId);return cluster?cluster.id:void 0}return{availableZoomLevels:clusterLevels.map(cl=>+cl.zoom).sort((a,b)=>Object(ascending.a)(a,b)),getClusterNodesFor:zoom=>{if(void 0!==zoom)return nodesByZoom.get(zoom)},getClusterById:clusterId=>clustersById.get(clusterId),getMinZoomForLocation:locationId=>minZoomByLocationId.get(locationId)||minZoom,expandCluster:(cluster,targetZoom=maxZoom)=>{const ids=[],visit=(c,expandedIds)=>{if(targetZoom>c.zoom)for(const childId of c.children){const child=clustersById.get(childId);child?visit(child,expandedIds):expandedIds.push(childId)}else expandedIds.push(c.id)};return visit(cluster,ids),ids},findClusterFor:findClusterFor,aggregateFlows:(flows,zoom,{getFlowOriginId:getFlowOriginId,getFlowDestId:getFlowDestId,getFlowMagnitude:getFlowMagnitude},options={})=>{if(zoom>maxZoom)return flows;const result=[],aggFlowsByKey=new Map,makeKey=(origin,dest)=>`${origin}:${dest}`,{flowCountsMapReduce:flowCountsMapReduce={map:getFlowMagnitude,reduce:(acc,count)=>(acc||0)+count}}=options;for(const flow of flows){const origin=getFlowOriginId(flow),dest=getFlowDestId(flow),originCluster=findClusterFor(origin,zoom)||origin,destCluster=findClusterFor(dest,zoom)||dest,key=makeKey(originCluster,destCluster);if(originCluster===origin&&destCluster===dest)result.push(flow);else{let aggregateFlow=aggFlowsByKey.get(key);aggregateFlow?aggregateFlow.count=flowCountsMapReduce.reduce(aggregateFlow.count,flowCountsMapReduce.map(flow)):(aggregateFlow={origin:originCluster,dest:destCluster,count:flowCountsMapReduce.map(flow),aggregate:!0},result.push(aggregateFlow),aggFlowsByKey.set(key,aggregateFlow))}}return result}}}function makeLocationWeightGetter(flows,{getFlowOriginId:getFlowOriginId,getFlowDestId:getFlowDestId,getFlowMagnitude:getFlowMagnitude}){const locationTotals={incoming:new Map,outgoing:new Map};for(const flow of flows){const origin=getFlowOriginId(flow),dest=getFlowDestId(flow),count=getFlowMagnitude(flow);locationTotals.incoming.set(dest,(locationTotals.incoming.get(dest)||0)+count),locationTotals.outgoing.set(origin,(locationTotals.outgoing.get(origin)||0)+count)}return id=>Math.max(Math.abs(locationTotals.incoming.get(id)||0),Math.abs(locationTotals.outgoing.get(id)||0))}function findAppropriateZoomLevel(availableZoomLevels,targetZoom){if(!availableZoomLevels.length)throw new Error("No available zoom levels");return availableZoomLevels[Math.min(Object(bisect.a)(availableZoomLevels,Math.floor(targetZoom)),availableZoomLevels.length-1)]}var group=__webpack_require__(858),src=__webpack_require__(307);const defaultOptions={minZoom:0,maxZoom:16,radius:40,extent:512,nodeSize:64,makeClusterName:(id,numPoints)=>{},makeClusterId:id=>`{[${id}]}`};function isLeafPoint(p){const{index:index}=p;return null!=index}function isClusterPoint(p){const{id:id}=p;return null!=id}function clusterLocations(locations,locationAccessors,getLocationWeight,options){const{getLocationCentroid:getLocationCentroid,getLocationId:getLocationId}=locationAccessors,opts=Object.assign(Object.assign({},defaultOptions),options),{minZoom:minZoom,maxZoom:maxZoom,nodeSize:nodeSize,makeClusterName:makeClusterName,makeClusterId:makeClusterId}=opts,trees=new Array(maxZoom+1);let clusters=new Array;for(let i=0;i<locations.length;i++){const[x,y]=getLocationCentroid(locations[i]);clusters.push({x:(lng=x,lng/360+.5),y:latY(y),weight:getLocationWeight(getLocationId(locations[i])),zoom:1/0,index:i,parentId:-1})}var lng;trees[maxZoom+1]=new src.a(clusters,getX,getY,nodeSize,Float32Array);for(let z=maxZoom;z>=minZoom;z--)clusters=cluster(clusters,z,trees[z+1],opts),trees[z]=new src.a(clusters,getX,getY,nodeSize,Float32Array);if(0===trees.length)return[];const numbersOfClusters=trees.map(d=>d.points.length),maxAvailZoom=numbersOfClusters.indexOf(numbersOfClusters[numbersOfClusters.length-1]),minAvailZoom=Math.min(maxAvailZoom,numbersOfClusters.lastIndexOf(numbersOfClusters[0])),clusterLevels=new Array;for(let zoom=minAvailZoom;zoom<=maxAvailZoom;zoom++){let childrenByParent;const tree=trees[zoom];zoom<maxAvailZoom&&(childrenByParent=Object(group.a)(trees[zoom+1].points,points=>points.map(p=>p.id?makeClusterId(p.id):getLocationId(locations[p.index])),point=>point.parentId));const nodes=[];for(const point of tree.points){const{x:x,y:y,numPoints:numPoints}=point;if(isLeafPoint(point)){const location=locations[point.index];nodes.push({id:getLocationId(location),zoom:zoom,centroid:getLocationCentroid(location)})}else if(isClusterPoint(point)){const{id:id}=point,children=childrenByParent&&childrenByParent.get(id);if(!children)throw new Error(`Cluster ${id} doesn't have children`);nodes.push({id:makeClusterId(id),name:makeClusterName(id,numPoints),zoom:zoom,centroid:[xLng(x),yLat(y)],children:children})}}clusterLevels.push({zoom:zoom,nodes:nodes})}return clusterLevels}function createCluster(x,y,id,numPoints,weight){return{x:x,y:y,zoom:1/0,id:id,parentId:-1,numPoints:numPoints,weight:weight}}function cluster(points,zoom,tree,options){const clusters=[],{radius:radius,extent:extent}=options,r=radius/(extent*Math.pow(2,zoom));for(let i=0;i<points.length;i++){const p=points[i];if(p.zoom<=zoom)continue;p.zoom=zoom;const neighborIds=tree.within(p.x,p.y,r);let weight=p.weight||1,numPoints=isClusterPoint(p)?p.numPoints:1,wx=p.x*weight,wy=p.y*weight;const id=(i<<5)+(zoom+1);for(const neighborId of neighborIds){const b=tree.points[neighborId];if(b.zoom<=zoom)continue;b.zoom=zoom;const weight2=b.weight||1,numPoints2=b.numPoints||1;wx+=b.x*weight2,wy+=b.y*weight2,weight+=weight2,numPoints+=numPoints2,b.parentId=id}1===numPoints?clusters.push(p):(p.parentId=id,clusters.push(createCluster(wx/weight,wy/weight,id,numPoints,weight)))}return clusters}function xLng(x){return 360*(x-.5)}function yLat(y){const y2=(180-360*y)*Math.PI/180;return 360*Math.atan(Math.exp(y2))/Math.PI-90}function latY(lat){const sin=Math.sin(lat*Math.PI/180),y=.5-.25*Math.log((1+sin)/(1-sin))/Math.PI;return y<0?0:y>1?1:y}function getX(p){return p.x}function getY(p){return p.y}}},[[446,1,2]]]);
//# sourceMappingURL=main.32e98362b7fd7e50b254.bundle.js.map